<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZRMCA_FROMBANK_PAYMENTS_V2</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZRMCA_FROMBANK_PAYMENTS_V2</h2>
<h3> Description: AlbTelecom: Upload Payments from Bank File</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Report&nbsp;&nbsp;ZRMCA_FROMBANK_PAYMENTS<br />
*&<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;Author:&nbsp;DI&nbsp;(FH)&nbsp;Thomas&nbsp;Drobitsch<br />
*&&nbsp;Date:&nbsp;&nbsp;&nbsp;18.10.2012<br />
*&&nbsp;Description:&nbsp;This&nbsp;program&nbsp;reads&nbsp;the&nbsp;payment&nbsp;file&nbsp;of&nbsp;each&nbsp;bank<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;creates&nbsp;a&nbsp;payment&nbsp;lot.<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;input&nbsp;file&nbsp;is&nbsp;expected&nbsp;in&nbsp;directory:<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/albtelecom/rmca/inbound/payments/<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;output&nbsp;file&nbsp;is&nbsp;created&nbsp;in&nbsp;directory:<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/albtelecom/rmca/outbound/pay_lot/<br />
*&<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
REPORT  zrmca_frombank_payments_v2.<br />
<br />
TABLES: bfkkzgr00, bfkkzk, bfkkzp, bfkkzs, bfkkzv.<br />
<br />
CONSTANTS: co_bal_object TYPE balobj_d VALUE 'ZRMCA_IF',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;co_bal_subobject&nbsp;TYPE&nbsp;balsubobj&nbsp;VALUE&nbsp;'PAYMENTS_IN'.<br />
<br />
TYPES: BEGIN OF ty_file_header,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_sign(1)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source_name(20)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_name(20)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_type(4)&nbsp;TYPE&nbsp;n,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_file_header,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_file_footer,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;footer_sign(3)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records_count(10)&nbsp;TYPE&nbsp;n,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_file_footer,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_bank_payments,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bnkid&nbsp;TYPE&nbsp;bu_bkvid,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xblnr&nbsp;TYPE&nbsp;xblnr_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phone_number(12)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_name(100)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;betrw&nbsp;TYPE&nbsp;betrw_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date(8)&nbsp;TYPE&nbsp;c,&nbsp;"payment&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcode(50)&nbsp;TYPE&nbsp;c,&nbsp;"transaction&nbsp;code<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_bank_payments,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_line,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line(250)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_line,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_lheader,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineid(2)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document_date(8)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;posting_date(8)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_date(8)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bank_id(4)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_lheader,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_litem,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lineid(2)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selt1(1)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selw1(35)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selt2(1)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selw2(35)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;betrz(18)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xakon(1)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xklae(1)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_litem,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_bank_id,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bnkid&nbsp;TYPE&nbsp;bu_bkvid,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_bank_id,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_vkont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_vkont.<br />
<br />
DATA: lv_subrc(1) TYPE n,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_filename&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_filetable&nbsp;TYPE&nbsp;filetable,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_filetable&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_filetable,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_line&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_line&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_line&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_line,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_header&nbsp;TYPE&nbsp;ty_file_header,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_footer&nbsp;TYPE&nbsp;ty_file_footer,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_all_payments&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_bank_payments,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_payments&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_bank_payments,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_payments,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_keyz1&nbsp;TYPE&nbsp;keyz1_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_keyz1x(12)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_lheader&nbsp;TYPE&nbsp;ty_lheader,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fkkzest&nbsp;TYPE&nbsp;fkkzest,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead&nbsp;TYPE&nbsp;zrw_cd_pl_header,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;zrw_cd_pl_item&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_db_bank&nbsp;TYPE&nbsp;zrmca_db_bank,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_litem&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_litem,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_litem&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_litem,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bank_id&nbsp;TYPE&nbsp;bu_bkvid,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_bank_id&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_bank_id,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_bank_id&nbsp;TYPE&nbsp;ty_bank_id,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_filed&nbsp;TYPE&nbsp;localfile,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_vkont&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_vkont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_vkont&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_vkont.<br />
<br />
DATA: lv_bal_log_handle TYPE balloghndl,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_msg&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return&nbsp;&nbsp;TYPE&nbsp;bapiret2.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-001.<br />
<br />
SELECTION-SCREEN SKIP 1.<br />
<br />
PARAMETERS: p_fileu TYPE localfile<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT&nbsp;'/albtelecom/rmca/inbound/payments/'.<br />
<br />
PARAMETERS: p_filed TYPE localfile<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT&nbsp;'/albtelecom/rmca/outbound/pay_lot/'&nbsp;NO-DISPLAY.<br />
<br />
SELECTION-SCREEN END OF BLOCK b1.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK b2 WITH FRAME TITLE text-002.<br />
<br />
PARAMETERS: p_xcont LIKE fkkzepar-xcont DEFAULT ' ' NO-DISPLAY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_xclos&nbsp;LIKE&nbsp;fkkzepar-xclos&nbsp;DEFAULT&nbsp;'X'&nbsp;NO-DISPLAY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_xbuch&nbsp;LIKE&nbsp;fkkzepar-xbuch&nbsp;DEFAULT&nbsp;'X'.<br />
<br />
SELECTION-SCREEN SKIP 1.<br />
<br />
PARAMETERS: p_wsu AS CHECKBOX USER-COMMAND flag DEFAULT ' '.<br />
<br />
SELECTION-SCREEN END OF BLOCK b2.<br />
<br />
INITIALIZATION.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;initialization.<br />
<br />
START-OF-SELECTION.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_subrc,&nbsp;lv_filename,&nbsp;lv_filed,&nbsp;lt_bank_id[],&nbsp;lt_vkont[].<br />
&nbsp;&nbsp;REFRESH:&nbsp;lt_line.<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_wsu&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;get_filename.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;upload_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;split_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;elushi.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;upload_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;split_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_bank_id&nbsp;INTO&nbsp;ls_bank_id.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lt_payments[],&nbsp;wa_payments,&nbsp;lt_vkont[],&nbsp;wa_vkont.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_all_payments&nbsp;INTO&nbsp;wa_payments&nbsp;WHERE&nbsp;bnkid&nbsp;EQ&nbsp;ls_bank_id-bnkid.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_payments&nbsp;TO&nbsp;lt_payments.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;fill&nbsp;contract&nbsp;account&nbsp;table<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_payments-vkont&nbsp;TO&nbsp;wa_vkont-vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_vkont&nbsp;TO&nbsp;lt_vkont.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;lt_vkont.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;elushi.<br />
   </div>
   <div class="codeComment">
*fill&nbsp;lot&nbsp;header&nbsp;data<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_header_data.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*fill&nbsp;lot&nbsp;item&nbsp;data<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_item_data.<br />
<br />
   </div>
   <div class="codeComment">
*create&nbsp;lot&nbsp;file<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;p_filed&nbsp;lv_keyz1&nbsp;'.txt'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;create_lot_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;schedule_job.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;MESSAGE&nbsp;s000(zrmj_if_md)&nbsp;WITH&nbsp;'File&nbsp;processed!&nbsp;Please&nbsp;check&nbsp;application&nbsp;log.'.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_FILENAME<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM get_filename .<br />
<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_user_action&nbsp;TYPE&nbsp;i,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_rc&nbsp;TYPE&nbsp;i.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_user_action,&nbsp;lv_rc,&nbsp;lt_filetable[].<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;file_open_dialog<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window_title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'Select&nbsp;files&nbsp;to&nbsp;import'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH_ENCODING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_directory&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;workdir<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_extension&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'txt'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;filename<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_filter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'*.txt'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiselection&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_filetable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_user_action<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_rc<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_encoding&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;encoding<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cntl_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;lv_user_action&nbsp;NE&nbsp;0&nbsp;OR&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'You&nbsp;have&nbsp;to&nbsp;select&nbsp;a&nbsp;file!'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e080(zrmcaj_if).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_filetable.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-tfill&nbsp;&gt;&nbsp;1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Select&nbsp;only&nbsp;one&nbsp;file!'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e081(zrmcaj_if).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_filetable&nbsp;INTO&nbsp;wa_filetable&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;lv_filename&nbsp;=&nbsp;wa_filetable-filename.<br />
<br />
ENDFORM.                    " GET_FILENAME<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;UPLOAD_FILE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM upload_file .<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;ls_header,&nbsp;ls_footer.<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_wsu&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;gui_upload<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filetype&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'DAT'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;has_field_separator&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_length&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_by_line&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dat_mode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codepage&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;SPACE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignore_cerr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ABAP_TRUE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;replacement&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'#'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virus_scan_profile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filelength&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_line[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_open_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_read_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_batch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gui_refuse_filetransfer&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_authority&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bad_data_format&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_not_allowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator_not_allowed&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_too_long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_dp_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_denied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;13<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_out_of_memory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;14<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disk_full&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_timeout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;16<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;17<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;18<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;19.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0&nbsp;OR&nbsp;lt_line[]&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Upload&nbsp;of&nbsp;file&nbsp;failed!'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e082(zrmcaj_if).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;OPEN&nbsp;DATASET&nbsp;p_fileu&nbsp;FOR&nbsp;INPUT&nbsp;IN&nbsp;LEGACY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT&nbsp;MODE&nbsp;CODE&nbsp;PAGE&nbsp;'1100'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;while&nbsp;opening&nbsp;the&nbsp;file&nbsp;',&nbsp;p_fileu.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e083(zrmcaj_if)&nbsp;WITH&nbsp;p_fileu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;wa_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;DATASET&nbsp;p_fileu&nbsp;INTO&nbsp;wa_line.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_line&nbsp;TO&nbsp;lt_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLOSE&nbsp;DATASET&nbsp;p_fileu.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lt_line[]&nbsp;IS&nbsp;INITIAL.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'No&nbsp;entries&nbsp;found&nbsp;in&nbsp;source&nbsp;file&nbsp;',&nbsp;p_fileu.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e084(zrmcaj_if)&nbsp;WITH&nbsp;p_fileu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " UPLOAD_FILE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SPLIT_FILE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM split_file .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_betrw(18)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_paid_fee(18)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_lines&nbsp;TYPE&nbsp;sytfill,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bldat(10)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bank_date_old(10)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_count(300)&nbsp;TYPE&nbsp;c.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_cr&nbsp;TYPE&nbsp;char1.&nbsp;"CR<br />
<br />
&nbsp;&nbsp;lv_cr&nbsp;=&nbsp;cl_abap_char_utilities=&gt;cr_lf.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_lines,&nbsp;lv_bank_date_old,&nbsp;lv_count.<br />
<br />
   </div>
   <div class="codeComment">
*ignore&nbsp;first&nbsp;line,&nbsp;because&nbsp;it&nbsp;is&nbsp;the&nbsp;header&nbsp;line<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DELETE&nbsp;lt_line&nbsp;INDEX&nbsp;1.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_line&nbsp;INTO&nbsp;wa_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;lv_cr&nbsp;IN&nbsp;wa_line&nbsp;WITH&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;wa_line+0(3)&nbsp;EQ&nbsp;'EOF'.&nbsp;"File&nbsp;footer<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPLIT&nbsp;wa_line&nbsp;AT&nbsp;';'&nbsp;INTO&nbsp;ls_footer-footer_sign<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;lv_count&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_count&nbsp;TO&nbsp;ls_footer-records_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.&nbsp;"File&nbsp;items<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;wa_payments,&nbsp;lv_betrw,&nbsp;lv_paid_fee,&nbsp;lv_bldat.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPLIT&nbsp;wa_line&nbsp;AT&nbsp;'|'&nbsp;INTO&nbsp;wa_payments-bnkid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-xblnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-phone_number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-customer_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_betrw<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bldat<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-tcode.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_betrw&nbsp;TO&nbsp;wa_payments-betrw.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;'/'&nbsp;IN&nbsp;lv_bldat&nbsp;WITH&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;lv_bldat+4(4)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bldat+2(2)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bldat+0(2)&nbsp;INTO&nbsp;wa_payments-date.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-tabix&nbsp;EQ&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_payments-date&nbsp;TO&nbsp;lv_bank_date_old.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_bank_date_old&nbsp;&lt;&gt;&nbsp;wa_payments-date.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e091(zrmcaj_if)&nbsp;WITH&nbsp;lv_bank_date_old<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_payments-date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_payments&nbsp;TO&nbsp;lt_all_payments.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_payments-bnkid&nbsp;TO&nbsp;ls_bank_id-bnkid.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_bank_id&nbsp;TO&nbsp;lt_bank_id.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;lt_bank_id.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;lt_bank_id.<br />
<br />
&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_line&nbsp;LINES&nbsp;lv_lines.<br />
<br />
&nbsp;&nbsp;lv_lines&nbsp;=&nbsp;lv_lines&nbsp;-&nbsp;1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ls_footer-records_count&nbsp;&lt;&gt;&nbsp;lv_lines.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Number&nbsp;of&nbsp;records&nbsp;in&nbsp;file&nbsp;are&nbsp;not&nbsp;the&nbsp;same'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e085(zrmcaj_if)&nbsp;WITH&nbsp;lv_lines&nbsp;ls_footer-records_count<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " SPLIT_FILE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_HEADER_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_header_data .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;nn(2)&nbsp;TYPE&nbsp;n,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_off&nbsp;&nbsp;TYPE&nbsp;i,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_moff&nbsp;TYPE&nbsp;i,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_mlen&nbsp;TYPE&nbsp;i.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_keyz1.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_payments&nbsp;INTO&nbsp;wa_payments&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;MOVE&nbsp;wa_payments-bnkid&nbsp;TO&nbsp;lv_bank_id.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'P'&nbsp;lv_bank_id+1(3)&nbsp;wa_payments-date+2(6)&nbsp;'00'&nbsp;INTO&nbsp;lv_keyz1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;check&nbsp;if&nbsp;lot&nbsp;already&nbsp;exists<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;ls_fkkzest<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;fkkzest<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;runid&nbsp;=&nbsp;lv_keyz1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;nn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DO&nbsp;99&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;nn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'P'&nbsp;lv_bank_id+1(3)&nbsp;wa_payments-date+2(6)&nbsp;nn&nbsp;INTO&nbsp;lv_keyz1x.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;ls_fkkzest<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;fkkzest<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;runid&nbsp;=&nbsp;lv_keyz1x.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_keyz1&nbsp;=&nbsp;lv_keyz1x.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ls_plhead-keyz1&nbsp;=&nbsp;lv_keyz1.&nbsp;"payment&nbsp;lot<br />
<br />
&nbsp;&nbsp;ls_plhead-bukrs&nbsp;=&nbsp;'910'.&nbsp;"company&nbsp;code<br />
<br />
&nbsp;&nbsp;ls_plhead-waers&nbsp;=&nbsp;'ALL'.&nbsp;"curr.<br />
&nbsp;&nbsp;ls_plhead-augrd&nbsp;=&nbsp;'01'.&nbsp;"clearing&nbsp;reason<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_payments&nbsp;INTO&nbsp;wa_payments&nbsp;INDEX&nbsp;1.<br />
<br />
&nbsp;&nbsp;ls_plhead-bldat&nbsp;=&nbsp;wa_payments-date.&nbsp;"document&nbsp;date<br />
&nbsp;&nbsp;ls_plhead-budat&nbsp;=&nbsp;wa_payments-date.&nbsp;"posting&nbsp;date<br />
&nbsp;&nbsp;ls_plhead-valut&nbsp;=&nbsp;wa_payments-date.&nbsp;"value&nbsp;date<br />
<br />
   </div>
   <div class="codeComment">
*get&nbsp;bank&nbsp;clearing&nbsp;account&nbsp;and&nbsp;business&nbsp;area<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR:&nbsp;ls_db_bank.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;ls_db_bank<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zrmca_db_bank<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;bnkid&nbsp;=&nbsp;lv_bank_id.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ls_db_bank-gsber&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_db_bank-gsber&nbsp;=&nbsp;'T000'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Please&nbsp;update&nbsp;bank&nbsp;table&nbsp;for&nbsp;entry:&nbsp;',<br />
*ls_lheader-bank_id.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e086(zrmcaj_if)&nbsp;WITH&nbsp;lv_bank_id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ls_plhead-bvrko&nbsp;=&nbsp;ls_db_bank-bvrko.<br />
<br />
&nbsp;&nbsp;ls_plhead-blart&nbsp;=&nbsp;ls_db_bank-blart.<br />
<br />
&nbsp;&nbsp;IF&nbsp;lv_filename&nbsp;IS&nbsp;INITIAL.&nbsp;"search&nbsp;term<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;ls_db_bank-bnkid&nbsp;'/'&nbsp;lv_filed+34<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;ls_plhead-keyz2.<br />
&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_off&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHILE&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIND&nbsp;'\'&nbsp;IN&nbsp;SECTION&nbsp;OFFSET&nbsp;lv_off&nbsp;OF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_filename<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATCH&nbsp;OFFSET&nbsp;lv_moff<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MATCH&nbsp;LENGTH&nbsp;lv_mlen.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_off&nbsp;=&nbsp;lv_moff&nbsp;+&nbsp;lv_mlen.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDWHILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;ls_db_bank-bnkid&nbsp;'/'&nbsp;lv_filename+lv_off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;ls_plhead-keyz2.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ls_plhead-infof&nbsp;=&nbsp;ls_db_bank-infof.<br />
&nbsp;&nbsp;ls_plhead-gsber&nbsp;=&nbsp;ls_db_bank-gsber.<br />
<br />
<br />
ENDFORM.                    " FILL_HEADER_DATA<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_ITEM_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_item_data .<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;ty_invoices,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xblnr&nbsp;TYPE&nbsp;xblnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_invoices.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_tdata&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ist_tdata&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_tdata&nbsp;TYPE&nbsp;ist_tdata,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_duedate&nbsp;TYPE&nbsp;timestamp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_timestamp(20)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_invoices&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_invoices,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_invoices&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_invoices.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lt_plitem,&nbsp;lv_vkont,&nbsp;lt_invoices[],&nbsp;wa_invoices.<br />
&nbsp;&nbsp;REFRESH:&nbsp;lt_plitem.<br />
<br />
   </div>
   <div class="codeComment">
*get&nbsp;all&nbsp;open&nbsp;invoices&nbsp;for&nbsp;a&nbsp;given&nbsp;contract&nbsp;accounts<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;vkont&nbsp;xblnr&nbsp;INTO&nbsp;TABLE&nbsp;lt_invoices&nbsp;FROM&nbsp;dfkkop<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;lt_vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;vkont&nbsp;EQ&nbsp;lt_vkont-vkont&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;augst&nbsp;EQ&nbsp;'&nbsp;'.<br />
<br />
&nbsp;&nbsp;SORT&nbsp;lt_invoices&nbsp;BY&nbsp;vkont&nbsp;xblnr.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_payments&nbsp;INTO&nbsp;wa_payments.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_vkont,&nbsp;lt_plitem.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;fill&nbsp;item&nbsp;data<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-selt1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-selw1&nbsp;=&nbsp;wa_payments-xblnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-selt2&nbsp;=&nbsp;'K'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-selw2&nbsp;=&nbsp;wa_payments-vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-betrz&nbsp;=&nbsp;wa_payments-betrw.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_plitem-valut&nbsp;=&nbsp;wa_payments-date.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;&nbsp;=&nbsp;wa_payments-xblnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;wa_payments-xblnr.<br />
<br />
   </div>
   <div class="codeComment">
*check&nbsp;whether&nbsp;invoice&nbsp;is&nbsp;still&nbsp;open&nbsp;and&nbsp;belongs&nbsp;to&nbsp;the&nbsp;contract&nbsp;account&nbsp;mentioned<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_invoices&nbsp;WITH&nbsp;KEY&nbsp;vkont&nbsp;=&nbsp;wa_payments-vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xblnr&nbsp;=&nbsp;wa_payments-xblnr&nbsp;INTO&nbsp;wa_invoices.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;'X'&nbsp;TO&nbsp;lt_plitem-xklae.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;'&nbsp;'&nbsp;TO&nbsp;lt_plitem-xklae.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lt_plitem.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.                    " FILL_ITEM_DATA<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_LOT_FILE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM create_lot_file .<br />
<br />
&nbsp;&nbsp;OPEN&nbsp;DATASET&nbsp;lv_filed&nbsp;FOR&nbsp;OUTPUT&nbsp;IN&nbsp;TEXT&nbsp;MODE&nbsp;ENCODING&nbsp;DEFAULT.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;writing&nbsp;file:&nbsp;',&nbsp;lv_filed.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e090(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*---&nbsp;write&nbsp;file&nbsp;header&nbsp;---<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;bfkkzgr00.<br />
&nbsp;&nbsp;bfkkzgr00-stype&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;bfkkzgr00-mandt&nbsp;=&nbsp;sy-mandt.<br />
&nbsp;&nbsp;bfkkzgr00-applk&nbsp;=&nbsp;'T'.<br />
<br />
&nbsp;&nbsp;TRANSFER&nbsp;bfkkzgr00&nbsp;TO&nbsp;lv_filed.<br />
<br />
   </div>
   <div class="codeComment">
*---&nbsp;create&nbsp;data&nbsp;---<br />
*&nbsp;&nbsp;zsname&nbsp;&nbsp;=&nbsp;ls_plhead-keyz1.<br />
<br />
*---&nbsp;Header&nbsp;---<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;bfkkzk.<br />
&nbsp;&nbsp;bfkkzk-stype&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;bfkkzk-tbnam&nbsp;=&nbsp;'BFKKZK'.<br />
&nbsp;&nbsp;MOVE:<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-keyz1&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-keyz1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Schlussel&nbsp;(Zahlunsstappel)<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-keyz2&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-keyz2,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Suchbegriff<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-infof&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-infof,&nbsp;"&nbsp;Additional&nbsp;Info<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-keyz1&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-fikey,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;FI-Key<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-bvrko&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-bvrko,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Bankverechnungs&nbsp;Konto<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-bukrs&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-bukrs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Buchungskreis<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-gsber&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-gsber,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Business&nbsp;Area<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-blart&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-blart,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Belegart<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-waers&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-waers,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Waerung<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-budat&nbsp;&nbsp;TO&nbsp;bfkkzk-budat,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Buchungsdatum<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-bldat&nbsp;&nbsp;TO&nbsp;bfkkzk-bldat,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Belegdatum<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-valut&nbsp;&nbsp;TO&nbsp;bfkkzk-valut,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Valutadatum<br />
"          'X' TO bfkkzk-xeiph,     " Einzelnepozition<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_plhead-augrd&nbsp;&nbsp;&nbsp;TO&nbsp;bfkkzk-augrd.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Ausgleichgrund<br />
<br />
<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;tabk&gt;.<br />
<br />
&nbsp;&nbsp;ASSIGN&nbsp;bfkkzk&nbsp;TO&nbsp;&lt;tabk&gt;.<br />
<br />
   </div>
   <div class="codeComment">
*---&nbsp;transfer&nbsp;to&nbsp;dataset&nbsp;---<br />
   </div>
   <div class="code">
&nbsp;&nbsp;TRANSFER&nbsp;&lt;tabk&gt;&nbsp;TO&nbsp;lv_filed.<br />
<br />
   </div>
   <div class="codeComment">
*---Positions&nbsp;---<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_plitem.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;tabp&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;bfkkzp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;bfkkzk&nbsp;TO&nbsp;bfkkzp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-stype&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-tbnam&nbsp;=&nbsp;'BFKKZP'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-betrz&nbsp;=&nbsp;lt_plitem-betrz.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-selt1&nbsp;=&nbsp;lt_plitem-selt1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-selw1&nbsp;=&nbsp;lt_plitem-selw1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-selt2&nbsp;=&nbsp;lt_plitem-selt2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-selw2&nbsp;=&nbsp;lt_plitem-selw2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-budat&nbsp;=&nbsp;lt_plitem-valut.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-bldat&nbsp;=&nbsp;lt_plitem-valut.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-valut&nbsp;=&nbsp;lt_plitem-valut.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-xakon&nbsp;=&nbsp;lt_plitem-xakon.<br />
&nbsp;&nbsp;&nbsp;&nbsp;bfkkzp-xklae&nbsp;=&nbsp;lt_plitem-xklae.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ASSIGN&nbsp;bfkkzp&nbsp;TO&nbsp;&lt;tabp&gt;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;TRANSFER&nbsp;&lt;tabp&gt;&nbsp;TO&nbsp;lv_filed.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLOSE&nbsp;DATASET&nbsp;lv_filed.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;writing&nbsp;file:&nbsp;',&nbsp;lv_filed.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e090(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;s065(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " CREATE_LOT_FILE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SCHEDULE_JOB<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM schedule_job .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_number&nbsp;TYPE&nbsp;tbtcjob-jobcount,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_name&nbsp;TYPE&nbsp;tbtcjob-jobname&nbsp;VALUE&nbsp;'RFKKZE_',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_pri_params&nbsp;TYPE&nbsp;pri_params,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_runid&nbsp;TYPE&nbsp;runidze_kk.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_number,&nbsp;lv_name,&nbsp;lv_pri_params,&nbsp;lv_runid.<br />
<br />
   </div>
   <div class="codeComment">
*run&nbsp;lot&nbsp;file<br />
   </div>
   <div class="code">
&nbsp;&nbsp;lv_runid&nbsp;=&nbsp;lv_keyz1.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'RFKKZE00'&nbsp;lv_runid&nbsp;INTO&nbsp;lv_name.<br />
&nbsp;&nbsp;MOVE&nbsp;'00000000'&nbsp;TO&nbsp;lv_number.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'JOB_OPEN'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobcount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_number<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cant_create_job&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_job_data&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname_missing&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;rfkkze00&nbsp;WITH&nbsp;p_runid&nbsp;=&nbsp;lv_runid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;as_fname&nbsp;=&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;p_xclos&nbsp;=&nbsp;p_xclos<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;p_xbuch&nbsp;=&nbsp;p_xbuch<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;p_xcont&nbsp;=&nbsp;p_xcont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;p_xsofst&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;SAP-SPOOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPOOL&nbsp;PARAMETERS&nbsp;lv_pri_params<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITHOUT&nbsp;SPOOL&nbsp;DYNPRO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIA&nbsp;JOB&nbsp;lv_name&nbsp;NUMBER&nbsp;lv_number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;RETURN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'JOB_CLOSE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobcount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strtimmed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cant_start_immediate&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_startdate&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname_missing&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_close_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_nosteps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_notex&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Job&nbsp;wasnt&nbsp;scheduled&nbsp;for&nbsp;file:&nbsp;',&nbsp;lv_filed&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e066(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Job&nbsp;wasnt&nbsp;scheduled&nbsp;for&nbsp;file:&nbsp;',&nbsp;lv_filed&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e066(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Job&nbsp;wasnt&nbsp;scheduled&nbsp;for&nbsp;file:&nbsp;',&nbsp;lv_filed&nbsp;.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e066(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Job&nbsp;',&nbsp;lv_name,&nbsp;'&nbsp;successfully&nbsp;scheduled!'.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MESSAGE&nbsp;s067(zrmcaj_if)&nbsp;WITH&nbsp;lv_filed<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_msg.<br />
   </div>
   <div class="codeComment">
*&nbsp;Edited&nbsp;by&nbsp;elushi.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;TABLES&nbsp;ztbl_ipl_ftp.<br />
&nbsp;&nbsp;DATA&nbsp;it_ztbl_ipl_ftp&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ztbl_ipl_ftp.<br />
&nbsp;&nbsp;DATA&nbsp;wa_ztbl_ipl_ftp&nbsp;TYPE&nbsp;ztbl_ipl_ftp.<br />
<br />
&nbsp;&nbsp;UPDATE&nbsp;ztbl_ipl_ftp&nbsp;SET&nbsp;processed&nbsp;=&nbsp;'X'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;WHERE&nbsp;file_nm&nbsp;=&nbsp;lv_filed<br />
*&nbsp;&nbsp;AND<br />
   </div>
   <div class="code">
&nbsp;&nbsp;where&nbsp;fullpath&nbsp;=&nbsp;p_fileu.<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;*****<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
ENDFORM.                    " SCHEDULE_JOB<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;INITIALIZATION<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM initialization .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CONCATENATE&nbsp;p_fileu&nbsp;'PAID'&nbsp;sy-datum&nbsp;INTO&nbsp;p_fileu.<br />
<br />
*/&nbsp;Create&nbsp;application&nbsp;log<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;bal_log_create<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_bal_log_handle&nbsp;.<br />
<br />
ENDFORM.                    " INITIALIZATION<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BAL_LOG_CREATE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_LV_BAL_LOG_HANDLE&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM bal_log_create  CHANGING pv_bal_log_handle.<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_log&nbsp;TYPE&nbsp;bal_s_log.<br />
<br />
<br />
&nbsp;&nbsp;MOVE&nbsp;co_bal_object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-object.<br />
&nbsp;&nbsp;MOVE&nbsp;co_bal_subobject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-subobject.<br />
&nbsp;&nbsp;MOVE&nbsp;sy-datum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-aldate.<br />
&nbsp;&nbsp;MOVE&nbsp;sy-uzeit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-altime.<br />
&nbsp;&nbsp;MOVE&nbsp;sy-uname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-aluser.<br />
&nbsp;&nbsp;MOVE&nbsp;sy-tcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-altcode.<br />
&nbsp;&nbsp;MOVE&nbsp;sy-repid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO&nbsp;ls_log-alprog.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Unique&nbsp;identifier&nbsp;for&nbsp;application&nbsp;log<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAL_LOG_CREATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_s_log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_log<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_log_handle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_bal_log_handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log_header_inconsistent&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_return<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'4'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " BAL_LOG_CREATE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BAL_LOG_MESSAGE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_GS_RETURN&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_1817&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM bal_log_message    USING ps_return    TYPE bapiret2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_probclass&nbsp;TYPE&nbsp;balprobcl.<br />
<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bal_s_msg.<br />
&nbsp;&nbsp;"&nbsp;&nbsp;ls_context&nbsp;TYPE&nbsp;zrw_baltab_md.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Define&nbsp;data&nbsp;of&nbsp;message&nbsp;for&nbsp;Application&nbsp;Log<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ps_return&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgty.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgid.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgno&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgno.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgv1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgv2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgv3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-probclass&nbsp;=&nbsp;pv_probclass.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgno&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-message_v1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-message_v2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-message_v3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ps_return-message_v4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-probclass&nbsp;=&nbsp;pv_probclass.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Append&nbsp;Message&nbsp;to&nbsp;Application&nbsp;Log<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;lv_bal_log_handle&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;Add&nbsp;this&nbsp;message&nbsp;to&nbsp;Application&nbsp;Log<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAL_LOG_MSG_ADD'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_s_msg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ls_msg<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_log_handle&nbsp;&nbsp;=&nbsp;lv_bal_log_handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log_not_found&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;&nbsp;&nbsp;Save&nbsp;Message<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;bal_log_save&nbsp;USING&nbsp;lv_bal_log_handle.<br />
<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;Raise&nbsp;Message&nbsp;for&nbsp;Displaying<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-msgty&nbsp;CA&nbsp;'EAX'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;ls_msg-msgid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ls_msg-msgty<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;ls_msg-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;ls_msg-msgv1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_msg-msgv4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " BAL_LOG_MESSAGE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BAL_LOG_SAVE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_LV_BAL_LOG_HANDLE&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM bal_log_save  USING pv_loghandle TYPE balloghndl.<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;lt_log_handle&nbsp;TYPE&nbsp;bal_t_logh.<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;&nbsp;pv_loghandle&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;APPEND&nbsp;pv_loghandle&nbsp;TO&nbsp;lt_log_handle.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Application&nbsp;Log:&nbsp;Database:&nbsp;Save&nbsp;logs<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAL_DB_SAVE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_t_log_handle&nbsp;=&nbsp;lt_log_handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log_not_found&nbsp;&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RAISING&nbsp;failed.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " BAL_LOG_SAVE<br />
<br />
   </div>
   <div class="codeComment">
*Text&nbsp;elements<br />
*----------------------------------------------------------<br />
*&nbsp;001&nbsp;Main&nbsp;Selection&nbsp;Window<br />
*&nbsp;002&nbsp;Additional&nbsp;Parameters<br />
<br />
<br />
*Selection&nbsp;texts<br />
*----------------------------------------------------------<br />
*&nbsp;P_BLART&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
*&nbsp;P_FILEU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Directory<br />
*&nbsp;P_WSU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Workstation&nbsp;Upload?<br />
*&nbsp;P_XBUCH&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
<br />
*Messages<br />
*----------------------------------------------------------<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;ZRMCAJ_IF<br />
*065&nbsp;&nbsp;&nbsp;File&nbsp;successfully&nbsp;created:&nbsp;&1<br />
*066&nbsp;&nbsp;&nbsp;Job&nbsp;wasn't&nbsp;scheduled&nbsp;for&nbsp;file:&nbsp;&1<br />
*067&nbsp;&nbsp;&nbsp;Job&nbsp;&1&nbsp;successfully&nbsp;scheduled<br />
*080&nbsp;&nbsp;&nbsp;You&nbsp;have&nbsp;to&nbsp;select&nbsp;a&nbsp;file!<br />
*081&nbsp;&nbsp;&nbsp;Select&nbsp;only&nbsp;one&nbsp;file!<br />
*082&nbsp;&nbsp;&nbsp;Upload&nbsp;of&nbsp;file&nbsp;failed!<br />
*083&nbsp;&nbsp;&nbsp;Error&nbsp;while&nbsp;opening&nbsp;file&nbsp;&1<br />
*084&nbsp;&nbsp;&nbsp;No&nbsp;entries&nbsp;found&nbsp;in&nbsp;source&nbsp;file&nbsp;&1<br />
*085&nbsp;&nbsp;&nbsp;Check&nbsp;of&nbsp;number&nbsp;of&nbsp;records&nbsp;failed&nbsp;(File&nbsp;&1&nbsp;&lt;&gt;&nbsp;&2&nbsp;in&nbsp;footer&nbsp;of&nbsp;file)<br />
*086&nbsp;&nbsp;&nbsp;Wrong&nbsp;Process&nbsp;Type,&nbsp;please&nbsp;check&nbsp;file&nbsp;&1<br />
*090&nbsp;&nbsp;&nbsp;Error&nbsp;writing&nbsp;file:&nbsp;&1<br />
*091&nbsp;&nbsp;&nbsp;Bank&nbsp;value&nbsp;date&nbsp;is&nbsp;not&nbsp;the&nbsp;same&nbsp;(&1&nbsp;&lt;&gt;&nbsp;&2)<br />
*<br />
*&nbsp;Message&nbsp;class:&nbsp;ZRMJ_IF_MD<br />
*000&nbsp;&nbsp;&nbsp;&&nbsp;&&nbsp;&&nbsp;&<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">* Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2015. Sap Release 731</td>
   </tr>
</table>
</body>
</html>
