<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZRMCA_BAD_DEBTS_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZRMCA_BAD_DEBTS_F01</h2>
<h3> Description: Include ZRMCA_BAD_DEBTS_F01</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZRMCA_BAD_DEBTS_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;EXIT_PROGRAM<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM exit_program .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Exit&nbsp;program&nbsp;...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_docking-&gt;free.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_cfw=&gt;flush.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_INFORM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;titel&nbsp;=&nbsp;gv_cprog<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txt2&nbsp;&nbsp;=&nbsp;sy-subrc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txt1&nbsp;&nbsp;=&nbsp;text-003.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
ENDFORM.                    " EXIT_PROGRAM<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_INIT_VALUE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM set_init_value .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Set&nbsp;the&nbsp;program&nbsp;name...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;gv_cprog&nbsp;=&nbsp;sy-cprog.<br />
<br />
&nbsp;&nbsp;button1&nbsp;=&nbsp;text-002.<br />
&nbsp;&nbsp;buttxt1&nbsp;=&nbsp;text-003.<br />
<br />
&nbsp;&nbsp;button2&nbsp;=&nbsp;text-002.<br />
&nbsp;&nbsp;buttxt2&nbsp;=&nbsp;text-024.<br />
<br />
&nbsp;&nbsp;button3&nbsp;=&nbsp;text-002.<br />
&nbsp;&nbsp;buttxt3&nbsp;=&nbsp;text-026.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;background&nbsp;session...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;get_max_available_bgd.<br />
ENDFORM.                    " SET_INIT_VALUE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;PREPARE_FIELD_CATALOG<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM prepare_field_catalog.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;ls_fcat&nbsp;TYPE&nbsp;lvc_s_fcat.<br />
   </div>
   <div class="codeComment">
*&nbsp;Get&nbsp;field&nbsp;catalog&nbsp;and&nbsp;change&nbsp;the&nbsp;control&nbsp;parameters&nbsp;for&nbsp;header...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'LVC_FIELDCATALOG_MERGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_structure_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZRMCA_AIP_HEAD_STR'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_structure_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZRMCA_BADDEPT_HEAD_STR'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct_fieldcat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_fieldcat<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inconsistent_interface&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;program_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_fieldcat&nbsp;INTO&nbsp;ls_fcat&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;ls_fcat-fieldname&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'VKONT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-hotspot&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'FIRST_UNPAID_INV'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'First&nbsp;Unpaid&nbsp;Date'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-tech&nbsp;=&nbsp;abap_on.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'MAKECALL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'Call'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;icon_phone_call_out.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-checkbox&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-edit&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-hotspot&nbsp;=&nbsp;abap_on.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abap_off.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SMSPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'SMS&nbsp;Status'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;abap_on.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-edit&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-reptext&nbsp;=&nbsp;text-008.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'LETTER1PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'First&nbsp;Letter&nbsp;Status'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;abap_on.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'LETTER2PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'Second&nbsp;Letter&nbsp;Status'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'MESSAGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'Keep&nbsp;Note&nbsp;for&nbsp;Debtors'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-edit&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-outputlen&nbsp;&nbsp;&nbsp;=&nbsp;40.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-emphasize&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-do_sum&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-no_zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'COURTPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'Court'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-icon&nbsp;=&nbsp;icon_legal_reg.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-checkbox&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-edit&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'ADSL_NUMBER'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'ADSL&nbsp;Number'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BPKIND'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'BP&nbsp;Type'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BPKIND_TEXT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'BP&nbsp;Kind&nbsp;Text'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'CONTACT_NUMBER'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_fcat-coltext&nbsp;=&nbsp;'Contact&nbsp;Number'.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_fieldcat&nbsp;FROM&nbsp;ls_fcat.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.                    " PREPARE_FIELD_CATALOG<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;PREPARE_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM prepare_layout.<br />
<br />
<br />
&nbsp;&nbsp;gs_layout-sel_mode&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;gs_layout-cwidth_opt&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;gs_layout-no_keyfix&nbsp;&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;gs_layout-cwidth_opt&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;gs_layout-sel_mode&nbsp;&nbsp;&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;gs_layout-info_fname&nbsp;=&nbsp;'COLOR'.<br />
&nbsp;&nbsp;gs_layout-zebra&nbsp;=&nbsp;'X'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;gs_layout-edit&nbsp;=&nbsp;'X'.<br />
<br />
   </div>
   <div class="code">
ENDFORM.                    " PREPARE_LAYOUT<br />
<br />
   </div>
   <div class="codeComment">
*&----------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;SET_CELL_COLOURS<br />
*&----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM set_cell_colours .<br />
<br />
&nbsp;&nbsp;TYPES:&nbsp;BEGIN&nbsp;OF&nbsp;y_t_itab,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;smsprocess&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zsmsstatus,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emailprocess&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;zemailstatus,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colortab&nbsp;TYPE&nbsp;lvc_t_scol,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;y_t_itab.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;color_tab&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;lvc_s_scol,<br />
&nbsp;&nbsp;&nbsp;wa_color&nbsp;TYPE&nbsp;lvc_s_scol.<br />
&nbsp;&nbsp;FIELD-SYMBOLS:&nbsp;&lt;f_wa_itab&gt;&nbsp;TYPE&nbsp;zrmca_baddept_head_str.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;ASSIGNING&nbsp;&nbsp;&lt;f_wa_itab&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;:&nbsp;color_tab[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&lt;f_wa_itab&gt;-smsprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;sms_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'SMSPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;5.&nbsp;&nbsp;"&nbsp;GREEN&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;contact_not_found.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'SMSPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;6.&nbsp;"&nbsp;RED&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&lt;f_wa_itab&gt;-emailprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;email_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'EMAILPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;5.&nbsp;&nbsp;"&nbsp;GREEN&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;email_not_found.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'EMAILPROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;6.&nbsp;"&nbsp;RED&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&lt;f_wa_itab&gt;-letter1process.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;first_letter_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'LETTER1PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;5.&nbsp;&nbsp;"&nbsp;GREEN&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;first_letter_failed.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'LETTER1PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;6.&nbsp;"&nbsp;RED&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;&lt;f_wa_itab&gt;-letter2process.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;second_letter_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'LETTER2PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;5.&nbsp;&nbsp;"&nbsp;GREEN&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;second_letter_failed.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-fname&nbsp;=&nbsp;'LETTER2PROCESS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_color-color-col&nbsp;=&nbsp;6.&nbsp;"&nbsp;RED&nbsp;color<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_color&nbsp;TO&nbsp;color_tab.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LINES&nbsp;OF&nbsp;color_tab&nbsp;INTO&nbsp;TABLE&nbsp;&lt;f_wa_itab&gt;-colortab.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;gs_layout-ctab_fname&nbsp;=&nbsp;'COLORTAB'.<br />
ENDFORM.                    " SET_CELL_COLOURS<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;EXCLUDE_STATUS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM exclude_status.<br />
&nbsp;&nbsp;DATA&nbsp;ls_exclude&nbsp;TYPE&nbsp;ui_func.<br />
<br />
&nbsp;&nbsp;REFRESH&nbsp;gt_exclude.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Exclude&nbsp;function&nbsp;codes...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_fc_graph.<br />
&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;gt_exclude.<br />
&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_fc_info.<br />
&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;gt_exclude.<br />
&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_mb_sum.<br />
&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;gt_exclude.<br />
&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_fc_detail.<br />
&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;gt_exclude.<br />
&nbsp;&nbsp;ls_exclude&nbsp;=&nbsp;cl_gui_alv_grid=&gt;mc_fc_find_more.<br />
&nbsp;&nbsp;APPEND&nbsp;ls_exclude&nbsp;TO&nbsp;gt_exclude.<br />
ENDFORM.                    " EXCLUDE_STATUS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;REFRESH_TABLE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM refresh_table .<br />
&nbsp;&nbsp;PERFORM&nbsp;data_retrieval.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;set_table_for_first_display<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gs_layout<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_toolbar_excluding&nbsp;=&nbsp;gt_exclude<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_group[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcatalog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_fieldcat[].<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;refresh_table_display.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;set_cell_colours.<br />
**<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;prepare_field_catalog.<br />
&nbsp;&nbsp;PERFORM&nbsp;prepare_layout.<br />
&nbsp;&nbsp;PERFORM&nbsp;set_cell_colours.<br />
&nbsp;&nbsp;PERFORM&nbsp;exclude_status.<br />
   </div>
   <div class="codeComment">
**<br />
**&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;set_table_for_first_display<br />
**&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_layout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gs_layout<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_toolbar_excluding&nbsp;=&nbsp;gt_exclude<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'A'<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
**&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_outtab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_group[]<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_fieldcatalog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_fieldcat[].<br />
**<br />
**<br />
**&nbsp;&nbsp;grc_top-&gt;initialize_document(&nbsp;).<br />
**<br />
**&nbsp;&nbsp;gr_debtors-&gt;list_processing_events(&nbsp;EXPORTING&nbsp;i_event_name&nbsp;=&nbsp;'TOP_OF_PAGE'<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_dyndoc_id&nbsp;=&nbsp;grc_top&nbsp;).<br />
**<br />
**&nbsp;&nbsp;grc_top-&gt;html_control&nbsp;=&nbsp;gr_viewer.<br />
**&nbsp;&nbsp;grc_top-&gt;display_document(&nbsp;EXPORTING&nbsp;reuse_control&nbsp;=&nbsp;'X'<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent&nbsp;=&nbsp;gr_top&nbsp;).<br />
**<br />
**&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;set_toolbar_interactive.<br />
<br />
*&nbsp;&nbsp;PERFORM&nbsp;display_data.<br />
<br />
**&nbsp;&nbsp;DATA&nbsp;ls_stable&nbsp;TYPE&nbsp;lvc_s_stbl.<br />
***&nbsp;Refresh&nbsp;table...<br />
**&nbsp;&nbsp;ls_stable-row&nbsp;=&nbsp;ls_stable-col&nbsp;=&nbsp;'X'.<br />
**<br />
**&nbsp;&nbsp;gr_debtors-&gt;refresh_table_display(&nbsp;EXPORTING&nbsp;is_stable&nbsp;=&nbsp;ls_stable&nbsp;).<br />
***&nbsp;&nbsp;gr_details-&gt;refresh_table_display(&nbsp;EXPORTING&nbsp;is_stable&nbsp;=&nbsp;ls_stable&nbsp;).<br />
**&nbsp;&nbsp;SET&nbsp;SCREEN&nbsp;0.<br />
   </div>
   <div class="code">
ENDFORM.                    " REFRESH_TABLE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISPLAY_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM display_data.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Call&nbsp;screen&nbsp;for&nbsp;ALV...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;100.<br />
ENDFORM.                    " DISPLAY_DATA<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;PROGRAM_LOCK<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM program_lock .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Lock&nbsp;the&nbsp;program...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'ENQUEUE_EZPROG_LOCK'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_zrmca_program_lock&nbsp;=&nbsp;'E'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;programm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-cprog<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_scope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'3'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_wait&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreign_lock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;gv_locked&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " PROGRAM_LOCK<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CONFIRMATION<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM confirmation  USING    pv_text   TYPE char80<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pv_ques&nbsp;&nbsp;&nbsp;TYPE&nbsp;char80<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;pv_answer&nbsp;TYPE&nbsp;char1.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Confirmation...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;titlebar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_text<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_question&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_ques<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_button_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;text-012&nbsp;"&nbsp;Yes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_button_2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;text-013&nbsp;"&nbsp;No<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_cancel_button&nbsp;=&nbsp;space<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_button&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'2'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_answer<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " CONFIRMATION<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_SCREEN<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM set_screen .<br />
&nbsp;&nbsp;DATA:&nbsp;lt_param&nbsp;TYPE&nbsp;ustyp_t_parameters,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_param&nbsp;TYPE&nbsp;ustyp_parameters.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Check&nbsp;user&nbsp;parameters&nbsp;to&nbsp;change&nbsp;the&nbsp;screen...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SUSR_USER_PARAMETERS_GET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-uname<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_parameters&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_param<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_name_not_exist&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_param&nbsp;INTO&nbsp;ls_param&nbsp;WITH&nbsp;KEY&nbsp;parid&nbsp;=&nbsp;gc_paramid<br />
&nbsp;&nbsp;&nbsp;&nbsp;BINARY&nbsp;SEARCH.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;S_VKONT&nbsp;is&nbsp;created&nbsp;to&nbsp;test&nbsp;the&nbsp;program...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;ls_param-parva&nbsp;NE&nbsp;abap_on.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;screen-name&nbsp;CS&nbsp;'S_VKONT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screen-active&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " SET_SCREEN<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;MAINTAIN_TABLE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM maintain_table .<br />
<br />
&nbsp;&nbsp;IF&nbsp;sscrfields&nbsp;EQ&nbsp;'EX'.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Maintain&nbsp;tables&nbsp;(Check&nbsp;authority)...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'AUTHORITY_CHECK_TCODE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcode&nbsp;&nbsp;=&nbsp;gc_sm30<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_ok&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e059(eu)&nbsp;WITH&nbsp;gc_sm30.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Maintain&nbsp;table...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'VIEW_MAINTENANCE_CALL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_update<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_exc_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client_reference&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreign_lock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_clientindependent_auth&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_database_function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_editor_function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_show_auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_tvdir_entry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_upd_auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;only_show_allowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_field_in_dba_sellist&nbsp;=&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;13<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maintenance_prohibited&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;14<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSEIF&nbsp;sscrfields&nbsp;EQ&nbsp;'CN'.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Maintain&nbsp;tables&nbsp;(Check&nbsp;authority)...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'AUTHORITY_CHECK_TCODE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcode&nbsp;&nbsp;=&nbsp;gc_sm30<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_ok&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e059(eu)&nbsp;WITH&nbsp;gc_sm30.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Maintain&nbsp;table...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'VIEW_MAINTENANCE_CALL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_update<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_cn_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client_reference&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreign_lock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_clientindependent_auth&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_database_function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_editor_function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_show_auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_tvdir_entry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_upd_auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;only_show_allowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system_failure&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_field_in_dba_sellist&nbsp;=&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;view_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;13<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maintenance_prohibited&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;14<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSEIF&nbsp;sscrfields&nbsp;EQ&nbsp;&nbsp;'MT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;zrmca_bad_debts_edit&nbsp;VIA&nbsp;SELECTION-SCREEN&nbsp;AND&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " MAINTAIN_TABLE<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FETCH_DATA_FROM_BI<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fetch_data_from_bi .<br />
<br />
&nbsp;&nbsp;TRY.<br />
   </div>
   <div class="codeComment">
*&nbsp;Fetch&nbsp;data&nbsp;from&nbsp;BI<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;connect_to_bi.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;SQL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN&nbsp;C&nbsp;FOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPART,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKONT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BALANCE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIRST_UNPAID_INV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LAST_PRODUCED_INV,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHONE_NUMBER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADSL_NUMBER,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCK_LEVEL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ACCOUNT_TYPE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BPKIND,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BPKIND_TEXT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MC_NAME1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MC_NAME2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MC_CITY1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SMTP_ADDR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STR_SUPPL2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MC_STREET,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STR_SUPPL1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STR_SUPPL3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGION,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G_PREFIX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOCATION,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILDING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLOOR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTACT_NUMBER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;AT_BI.ER_OPEN_AMOUNT_RESULT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;rownum&nbsp;&lt;&nbsp;10000<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;CONTRACT_NO<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;TO_CHAR(START_DATE,&nbsp;'YYYYMMDD')&nbsp;START_DATE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;TO_CHAR(END_DATE,&nbsp;'YYYYMMDD')&nbsp;END_DATE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;SELECT&nbsp;CO.EXT_ID&nbsp;CONTRACT_NO<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;CV.START_DATE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;CV.END_DATE<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;CI.EXT_ID<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;ROW_NUMBER&nbsp;()&nbsp;OVER&nbsp;(PARTITION&nbsp;BY&nbsp;CO.EXT_ID&nbsp;ORDER&nbsp;BY&nbsp;CV.END_DATE&nbsp;DESC)&nbsp;LAST_RN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;RATING.CACI_VALIDITY&nbsp;CV<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;RATING.CACI&nbsp;CI<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CV.CACI_OID&nbsp;=&nbsp;CI.OID<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CV.PARTITION_ID&nbsp;=&nbsp;CI.PARTITION_ID<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;CV.CACO_OID&nbsp;=&nbsp;CI.CACO_OID<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JOIN&nbsp;RATING.CACO&nbsp;CO<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;CO.OID&nbsp;=&nbsp;CI.CACO_OID<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;CV.START_DATE&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LAST_RN&nbsp;=&nbsp;1<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDEXEC.<br />
   </div>
   <div class="codeComment">
**<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;SQL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;C&nbsp;INTO&nbsp;:gs_bi_debts<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDEXEC.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_bi_debts&nbsp;TO&nbsp;gt_bi_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDDO.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;SQL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLOSE&nbsp;C<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDEXEC.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;disconnect_from_bi.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;'fetch_data_from_bi:&nbsp;executed...'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_root&nbsp;INTO&nbsp;ex_ref&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;ex_ref-&gt;get_text(&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'fetch_data_from_bi:'&nbsp;lgmessage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ENDTRY.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;DELETE&nbsp;gt_cc_inact&nbsp;WHERE&nbsp;contract_no&nbsp;NOT&nbsp;IN&nbsp;s_contr&nbsp;OR&nbsp;end_date&nbsp;IS&nbsp;INITIAL.<br />
**<br />
**&nbsp;&nbsp;SORT&nbsp;gt_cc_inact&nbsp;BY&nbsp;contract_no.<br />
<br />
   </div>
   <div class="code">
ENDFORM.                    " FETCH_DATA_FROM_BI<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;INSERT_INTODB<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM insert_intodb .<br />
<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;gt_baddept_temp&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;zrmca_baddept.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;gr_baddept_temp&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;zrmca_baddept.<br />
&nbsp;&nbsp;DATA&nbsp;wa_baddept_temp&nbsp;TYPE&nbsp;zrmca_baddept.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;&nbsp;lv_index&nbsp;TYPE&nbsp;syindex.<br />
&nbsp;&nbsp;TRY&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;elushi.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;&nbsp;gt_bi_debts&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_bi_debts.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get&nbsp;data&nbsp;to&nbsp;check&nbsp;if&nbsp;this&nbsp;row&nbsp;exist.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;FROM&nbsp;zrmca_baddept&nbsp;INTO&nbsp;&nbsp;wa_baddept_temp<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;gpart&nbsp;EQ&nbsp;gr_bi_debts-&gt;gpart<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;vkont&nbsp;EQ&nbsp;gr_bi_debts-&gt;vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;first_unpaid_inv&nbsp;EQ&nbsp;gr_bi_debts-&gt;first_unpaid_inv<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;last_producet_inv&nbsp;EQ&nbsp;gr_bi_debts-&gt;last_producet_inv.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;INITIAL&nbsp;LINE&nbsp;TO&nbsp;gt_baddept_temp<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_baddept_temp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_bi_debts-&gt;*&nbsp;TO&nbsp;gr_baddept_temp-&gt;*.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;makecall&nbsp;=&nbsp;wa_baddept_temp-makecall.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;smsprocess&nbsp;=&nbsp;wa_baddept_temp-smsprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;emailprocess&nbsp;=&nbsp;wa_baddept_temp-emailprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;letter1process&nbsp;=&nbsp;wa_baddept_temp-letter1process.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;letter2process&nbsp;=&nbsp;wa_baddept_temp-letter2process.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;firstlettersentdate&nbsp;=&nbsp;wa_baddept_temp-firstlettersentdate.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;courtprocess&nbsp;=&nbsp;wa_baddept_temp-courtprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;message&nbsp;=&nbsp;wa_baddept_temp-message.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;lastchangedby&nbsp;=&nbsp;wa_baddept_temp-lastchangedby.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;lastchangeddate&nbsp;=&nbsp;wa_baddept_temp-lastchangeddate.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;lastchangedtime&nbsp;=&nbsp;wa_baddept_temp-lastchangedtime.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_baddept_temp-&gt;protocolnr&nbsp;=&nbsp;wa_baddept_temp-protocolnr.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;no&nbsp;existing&nbsp;data<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;insert...<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_index&nbsp;EQ&nbsp;1000.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept&nbsp;FROM&nbsp;TABLE&nbsp;gt_baddept_temp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;lv_index.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;data&nbsp;exist<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;update<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;zrmca_baddept&nbsp;FROM&nbsp;TABLE&nbsp;gt_baddept_temp.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;wa_baddept_temp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFRESH&nbsp;gt_baddept_temp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_root&nbsp;INTO&nbsp;ex_ref&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;ex_ref-&gt;get_text(&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'insert_intodb:'&nbsp;lgmessage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ENDTRY.<br />
ENDFORM.                    " INSERT_INTODB<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CONNECT_TO_BI<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM connect_to_bi .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;CCPRD&nbsp;Connection&nbsp;parameters&nbsp;on&nbsp;DBCON&nbsp;table...<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;DB&nbsp;Connection&nbsp;:&nbsp;CCPRD<br />
*&nbsp;DBMS&nbsp;:&nbsp;ORA<br />
*&nbsp;User&nbsp;Name&nbsp;:&nbsp;DWH_RO<br />
*&nbsp;DB&nbsp;password&nbsp;:&nbsp;*****<br />
*&nbsp;Conn.&nbsp;info&nbsp;:&nbsp;CCPRD.WORLD<br />
*&nbsp;Permanent&nbsp;:&nbsp;X<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;TRY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;SQL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONNECT&nbsp;TO&nbsp;:gc_db_con<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDEXEC.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;'connect_to_bi:&nbsp;BI&nbsp;Connection&nbsp;Error!...'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;text-005&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDTRY.<br />
ENDFORM.                    " CONNECT_TO_BI<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISCONNECT_FROM_BI<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM disconnect_from_bi .<br />
   </div>
   <div class="codeComment">
*&nbsp;Disconnect&nbsp;from&nbsp;BI...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CLEAR&nbsp;gv_error_message.<br />
<br />
&nbsp;&nbsp;TRY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;SQL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISCONNECT&nbsp;:gc_db_con<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDEXEC.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_sy_native_sql_error&nbsp;INTO&nbsp;gr_oref.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_error_message&nbsp;=&nbsp;gr_oref-&gt;get_text(&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;'disconnect_from_bi:&nbsp;disconnect&nbsp;from&nbsp;BI&nbsp;error...&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;lgmessage&nbsp;gv_error_message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ENDTRY.<br />
ENDFORM.                    " DISCONNECT_FROM_BI<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SENDSMS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sendsms .<br />
&nbsp;&nbsp;SORT&nbsp;gt_group&nbsp;BY&nbsp;balance&nbsp;DESCENDING.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;get_selected_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_index_rows&nbsp;=&nbsp;et_index_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_row_no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;et_row_no.<br />
&nbsp;&nbsp;IF&nbsp;et_row_no&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;et_row_no&nbsp;INTO&nbsp;wa_et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group&nbsp;INTO&nbsp;wa_group&nbsp;INDEX&nbsp;&nbsp;wa_et_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_group&nbsp;TO&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gt_group&nbsp;=&nbsp;lt_group.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;contact_number&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;&nbsp;AND<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;smsprocess&nbsp;IS&nbsp;INITIAL&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balance&nbsp;GT&nbsp;balance_limit.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gr_group-&gt;contact_number&nbsp;IS&nbsp;NOT&nbsp;INITIAL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;strlen(&nbsp;gr_group-&gt;contact_number&nbsp;)&nbsp;EQ&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;gr_group-&gt;contact_number(4)&nbsp;EQ&nbsp;'3556'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;limit_count&nbsp;&gt;&nbsp;max_nr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;l_sms_num.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_balance.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lt_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_ca.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_name.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_lastname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_duedate.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_sms_num&nbsp;=&nbsp;gr_group-&gt;contact_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;amounthr&nbsp;TYPE&nbsp;amounthr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amounthr&nbsp;=&nbsp;gr_group-&gt;balance.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_balance&nbsp;=&nbsp;amounthr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_ca&nbsp;=&nbsp;gr_group-&gt;vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_name&nbsp;=&nbsp;gr_group-&gt;mc_name1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_lastname&nbsp;=&nbsp;gr_group-&gt;mc_name2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_number&nbsp;=&nbsp;gr_group-&gt;phone_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;lv_contact&nbsp;TYPE&nbsp;ap_phone_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;lv_bd_cn&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;zrmca_bd_cn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;wa_bd_cn&nbsp;TYPE&nbsp;&nbsp;zrmca_bd_cn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;rows&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;lv_separatenr&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;cnumber<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;zrmca_bd_cn<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;lv_bd_cn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows&nbsp;=&nbsp;lines(&nbsp;lv_bd_cn&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_separatenr&nbsp;=&nbsp;max_nr&nbsp;/&nbsp;rows.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;&nbsp;index&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lv_bd_cn&nbsp;INTO&nbsp;wa_bd_cn.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;limit_count&nbsp;&lt;&nbsp;index&nbsp;*&nbsp;lv_separatenr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lv_bd_cn&nbsp;INTO&nbsp;wa_bd_cn&nbsp;INDEX&nbsp;index.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_contact&nbsp;=&nbsp;wa_bd_cn-cnumber.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;=&nbsp;index&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_duedate&nbsp;=&nbsp;p_dd.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;lv_duedate(4)&nbsp;lv_duedate+4(2)&nbsp;lv_duedate+6(2)&nbsp;INTO&nbsp;lv_duedate&nbsp;SEPARATED&nbsp;BY&nbsp;'-'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'I&nbsp;nderuar&nbsp;abonent&nbsp;,&nbsp;Ju&nbsp;lutemi&nbsp;te&nbsp;shlyeni&nbsp;detyrimet&nbsp;e&nbsp;prapambetura&nbsp;ne&nbsp;shume&nbsp;totale'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_balance&nbsp;'leke&nbsp;kundrejt&nbsp;Albtelecom&nbsp;per&nbsp;numrin'&nbsp;lv_number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'ne&nbsp;emer&nbsp;te'&nbsp;lv_name&nbsp;lv_lastname&nbsp;'brenda&nbsp;dates'&nbsp;lv_duedate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_text-line&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;&nbsp;lv_string&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Per&nbsp;cdo&nbsp;informacion&nbsp;rreth&nbsp;detyrimit&nbsp;tuaj&nbsp;mund&nbsp;te&nbsp;telefononi&nbsp;ne&nbsp;numrin'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_contact&nbsp;'Faleminderit.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_string&nbsp;&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRY&nbsp;.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*-----------------send&nbsp;sms&nbsp;class--------------<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_bcs=&gt;create_persistent<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECEIVING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;lr_sms.<br />
<br />
   </div>
   <div class="codeComment">
*lv_text-line&nbsp;=&nbsp;'this&nbsp;is&nbsp;&nbsp;text&nbsp;sms'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;''&nbsp;IN&nbsp;lv_text&nbsp;WITH&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;''&nbsp;IN&nbsp;lv_text&nbsp;WITH&nbsp;'c'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;''&nbsp;IN&nbsp;lv_text&nbsp;WITH&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPLACE&nbsp;ALL&nbsp;OCCURRENCES&nbsp;OF&nbsp;''&nbsp;IN&nbsp;lv_text&nbsp;WITH&nbsp;'e'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_text&nbsp;TO&nbsp;lt_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_string&nbsp;TO&nbsp;lt_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;elushi.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_document_bcs=&gt;create_document<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_type&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'RAW'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_subject&nbsp;=&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_text&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_text<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECEIVING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lr_document.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l_sms_num&nbsp;=&nbsp;'355672022517'."i_mobile'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_cam_address_bcs=&gt;create_sms_address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_service&nbsp;=&nbsp;'SMS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_number&nbsp;&nbsp;=&nbsp;l_sms_num<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECEIVING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lr_rec.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;lr_sms-&gt;add_recipient<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_recipient&nbsp;=&nbsp;lr_rec<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_express&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;lr_sms-&gt;set_document<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_document&nbsp;=&nbsp;lr_document.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;lr_sms-&gt;send<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECEIVING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;l_bool.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_root&nbsp;INTO&nbsp;ex_ref&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;ex_ref-&gt;get_text(&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'SENDSMS:'&nbsp;lgmessage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDTRY.<br />
   </div>
   <div class="codeComment">
*-------------------end&nbsp;call&nbsp;sms&nbsp;class--------<br />
***&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;color&nbsp;=&nbsp;gc_red.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_status&nbsp;=&nbsp;sms_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proccess_type&nbsp;=&nbsp;'SMS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;change_process_status&nbsp;USING&nbsp;process_status&nbsp;proccess_type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE."if&nbsp;contact&nbsp;number&nbsp;doesnt&nbsp;exist<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_status&nbsp;=&nbsp;contact_not_found.&nbsp;"'CONTACT_NOT_FOUND'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proccess_type&nbsp;=&nbsp;'SMS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;change_process_status&nbsp;USING&nbsp;process_status&nbsp;proccess_type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF."endif&nbsp;for&nbsp;contact&nbsp;number<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;save_sms_logs.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;lv_limcount&nbsp;=&nbsp;limit_count.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Send&nbsp;SMS&nbsp;Finished:&nbsp;Total&nbsp;'&nbsp;lv_limcount&nbsp;'SMS&nbsp;Sent'<br />
&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
ENDFORM.                    " SENDSMS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;save_sms_logs<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM save_sms_logs.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;gt_baddept_temp&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;zrmca_baddept.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;&nbsp;gr_baddept_temp&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;zrmca_baddept.<br />
*&nbsp;&nbsp;APPEND&nbsp;INITIAL&nbsp;LINE&nbsp;TO&nbsp;gt_baddept_temp<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_baddept_temp.<br />
*&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gr_baddept_temp-&gt;*.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_baddept_temp.<br />
&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE<br />
&nbsp;&nbsp;&nbsp;gt_baddept_temp..<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
ENDFORM.                    "save_sms_logs<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SENDEMAIL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sendemail .<br />
&nbsp;&nbsp;IF&nbsp;p_dd&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_group&nbsp;BY&nbsp;balance&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;get_selected_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_index_rows&nbsp;=&nbsp;et_index_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_row_no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;et_row_no&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;et_row_no&nbsp;INTO&nbsp;wa_et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group&nbsp;INTO&nbsp;wa_group&nbsp;INDEX&nbsp;&nbsp;wa_et_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_group&nbsp;TO&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_group&nbsp;=&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;smsprocess&nbsp;EQ&nbsp;sms_sent&nbsp;OR&nbsp;smsprocess&nbsp;EQ&nbsp;contact_not_found&nbsp;)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balance&nbsp;GT&nbsp;balance_limit&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emailprocess&nbsp;NE&nbsp;email_not_found&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emailprocess&nbsp;NE&nbsp;email_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gr_group-&gt;smtp_addr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;limit_count&nbsp;&gt;&nbsp;mail_max_nr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_balance.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_ca.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_name.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_lastname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;lv_duedate.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gt_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_smtp_addr&nbsp;=&nbsp;gr_group-&gt;smtp_addr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_balance&nbsp;=&nbsp;gr_group-&gt;balance.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_ca&nbsp;=&nbsp;gr_group-&gt;vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_name&nbsp;=&nbsp;gr_group-&gt;mc_name1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_lastname&nbsp;=&nbsp;gr_group-&gt;mc_name2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_phonenumber&nbsp;=&nbsp;gr_group-&gt;phone_number.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_duedate&nbsp;=&nbsp;gr_group-&gt;last_producet_inv.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_duedate&nbsp;=&nbsp;p_dd.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;lv_duedate+6(2)&nbsp;lv_duedate+4(2)&nbsp;lv_duedate(4)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_duedate&nbsp;SEPARATED&nbsp;BY&nbsp;'-'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_balance&nbsp;&gt;&nbsp;10000.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_mail_body_over10000.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_mail_body.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;send.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_status&nbsp;=&nbsp;email_sent.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proccess_type&nbsp;=&nbsp;'MAIL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;change_process_status&nbsp;USING&nbsp;process_status&nbsp;proccess_type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process_status&nbsp;=&nbsp;email_not_found.&nbsp;"'email_NOT_FOUND'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proccess_type&nbsp;=&nbsp;'MAIL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;change_process_status&nbsp;USING&nbsp;process_status&nbsp;proccess_type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_limcount&nbsp;=&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Send&nbsp;EMAIL&nbsp;Finished:&nbsp;Total&nbsp;'&nbsp;lv_limcount&nbsp;'EMAIL&nbsp;Sent'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;if&nbsp;date&nbsp;is&nbsp;not&nbsp;initalized<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;'SD'&nbsp;TYPE&nbsp;'E'&nbsp;NUMBER&nbsp;'775'&nbsp;WITH&nbsp;'Please&nbsp;specify&nbsp;UNTIL&nbsp;DATE'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " SENDEMAIL<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;save_email_logs<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM save_email_logs.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;gt_baddept_temp&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;zrmca_baddept.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;&nbsp;gr_baddept_temp&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;zrmca_baddept.<br />
*&nbsp;&nbsp;APPEND&nbsp;INITIAL&nbsp;LINE&nbsp;TO&nbsp;gt_baddept_temp<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_baddept_temp.<br />
*&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gr_baddept_temp-&gt;*.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_baddept_temp.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE&nbsp;gt_baddept_temp.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE<br />
&nbsp;&nbsp;gt_baddept_temp.<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
ENDFORM.                    "save_email_logs<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SENDLETTER1<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sendletter1 .<br />
   </div>
   <div class="codeComment">
*get&nbsp;selected&nbsp;rows<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;p_dd&nbsp;IS&nbsp;NOT&nbsp;INITIAL&nbsp;AND&nbsp;p_prot&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_group&nbsp;BY&nbsp;balance&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;get_selected_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_index_rows&nbsp;=&nbsp;et_index_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_row_no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;et_row_no&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;et_row_no&nbsp;INTO&nbsp;wa_et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group&nbsp;INTO&nbsp;wa_group&nbsp;INDEX&nbsp;&nbsp;wa_et_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_group&nbsp;TO&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_group&nbsp;=&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;pv_counter&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;frmname&nbsp;=&nbsp;letter1form.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balance&nbsp;GT&nbsp;letter1_min_bal&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;emailprocess&nbsp;EQ&nbsp;email_not_found&nbsp;OR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emailprocess&nbsp;EQ&nbsp;email_sent&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;letter1process&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;pv_counter.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;limit_count&nbsp;&gt;&nbsp;letter1_max_nr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;save_as_pdf&nbsp;USING&nbsp;pv_counter&nbsp;frmname.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_limcount&nbsp;=&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Send&nbsp;LETTER1&nbsp;Finished:&nbsp;Total&nbsp;'&nbsp;lv_limcount&nbsp;'LETTER1&nbsp;Sent'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;if&nbsp;date&nbsp;is&nbsp;not&nbsp;initalized<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;'SD'&nbsp;TYPE&nbsp;'E'&nbsp;NUMBER&nbsp;'775'<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;'Please&nbsp;specify&nbsp;UNTIL&nbsp;DATE&nbsp;or&nbsp;Protocol&nbsp;No'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " SENDLETTER1<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SENDLETTER2<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sendletter2 .<br />
&nbsp;&nbsp;IF&nbsp;p_prot&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
   </div>
   <div class="codeComment">
*Get&nbsp;selected&nbsp;rows<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SORT&nbsp;gt_group&nbsp;BY&nbsp;balance&nbsp;DESCENDING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;gr_debtors-&gt;get_selected_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_index_rows&nbsp;=&nbsp;et_index_rows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_row_no&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;et_row_no&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;et_row_no&nbsp;INTO&nbsp;wa_et_row_no.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group&nbsp;INTO&nbsp;wa_group&nbsp;INDEX&nbsp;&nbsp;wa_et_row_no-row_id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;wa_group&nbsp;TO&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_group&nbsp;=&nbsp;lt_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;pv_counter&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;&nbsp;&nbsp;frmname&nbsp;=&nbsp;letter2form.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balance&nbsp;GT&nbsp;letter2_min_bal&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;letter1process&nbsp;EQ&nbsp;first_letter_sent<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;letter2process&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;pv_counter.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;pv_counter&nbsp;=&nbsp;pv_counter&nbsp;+&nbsp;1.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;limit_count&nbsp;&gt;&nbsp;letter2_max_nr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;save_as_pdf&nbsp;USING&nbsp;pv_counter&nbsp;frmname.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_limcount&nbsp;=&nbsp;limit_count.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Send&nbsp;LETTER2&nbsp;Finished:&nbsp;Total&nbsp;'&nbsp;lv_limcount&nbsp;'LETTER2&nbsp;Sent'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;ELSE.<br />
   </div>
   <div class="codeComment">
*&nbsp;if&nbsp;date&nbsp;is&nbsp;not&nbsp;initalized<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;'SD'&nbsp;TYPE&nbsp;'E'&nbsp;NUMBER&nbsp;'775'<br />
&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;'Please&nbsp;specify&nbsp;UNTIL&nbsp;DATE&nbsp;or&nbsp;Protocol&nbsp;No'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " SENDLETTER2<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_MAIL_BODY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_mail_body .<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;i&gt;I&nbsp;nderuar&nbsp;Abonent,&lt;/i&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Detyrimi&nbsp;i&nbsp;akumular&nbsp;i&nbsp;Kontrates&nbsp;suaj:'&nbsp;lv_ca<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'ne&nbsp;Emer:'&nbsp;lv_name&nbsp;lv_lastname<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'eshte:'&nbsp;lv_balance&nbsp;'leke'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Ju&nbsp;lutem&nbsp;merrni&nbsp;masa&nbsp;te&nbsp;kryeni&nbsp;pagesen&nbsp;deri&nbsp;me&lt;b&gt;'&nbsp;lv_duedate&nbsp;'&lt;/b&gt;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Gjithashtu&nbsp;ju&nbsp;bejme&nbsp;me&nbsp;dije'<br />
&nbsp;&nbsp;'se&nbsp;Albtelecom&nbsp;ju&nbsp;mundeson&nbsp;pagesen&nbsp;me&nbsp;keste&nbsp;nepermjet&nbsp;nje&nbsp;marreveshje.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Albtelecom&nbsp;ju&nbsp;falenderon&nbsp;nese&nbsp;ju&nbsp;i&nbsp;keni'<br />
&nbsp;&nbsp;&nbsp;'paguar&nbsp;tashme&nbsp;detyrimet&nbsp;tuaja.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;i&gt;Best&nbsp;Regards,&lt;/i&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
   </div>
   <div class="code">
ENDFORM.                    " FILL_MAIL_BODY<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_MAIL_BODY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_mail_body_over10000 .<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;i&gt;I&nbsp;nderuar&nbsp;Abonent,&lt;/i&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Detyrimi&nbsp;i&nbsp;akumular&nbsp;i&nbsp;Kontrates&nbsp;suaj:'&nbsp;lv_ca<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'ne&nbsp;Emer:'&nbsp;lv_name&nbsp;lv_lastname<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'eshte:'&nbsp;lv_balance&nbsp;'leke'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Ju&nbsp;lutem&nbsp;merrni&nbsp;masa&nbsp;te&nbsp;kryeni&nbsp;pagesen&nbsp;deri&nbsp;me&lt;b&gt;'&nbsp;lv_duedate&nbsp;'&lt;/b&gt;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;',&nbsp;ne&nbsp;te&nbsp;kundert&nbsp;do&nbsp;te&nbsp;jemi&nbsp;te&nbsp;detyruar'<br />
&nbsp;&nbsp;'te&nbsp;ndjekim&nbsp;rruget&nbsp;ligjore&nbsp;per&nbsp;zgjidhjen&nbsp;e&nbsp;situates.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Gjithashtu&nbsp;ju&nbsp;bejme&nbsp;me&nbsp;dije'<br />
&nbsp;&nbsp;'se&nbsp;Albtelecom&nbsp;ju&nbsp;mundeson&nbsp;pagesen&nbsp;me&nbsp;keste&nbsp;nepermjet&nbsp;nje&nbsp;marreveshje.'<br />
&nbsp;&nbsp;',&nbsp;si&nbsp;dhe&nbsp;per&nbsp;cdo&nbsp;paqartesi&nbsp;tjeter&nbsp;mund&nbsp;te&nbsp;organizohet&nbsp;nje&nbsp;takim.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;ap.<br />
<br />
&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
&nbsp;&nbsp;ap.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'Albtelecom&nbsp;ju&nbsp;falenderon&nbsp;nese&nbsp;ju&nbsp;i&nbsp;keni'<br />
&nbsp;&nbsp;&nbsp;'paguar&nbsp;tashme&nbsp;detyrimet&nbsp;tuaja.'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gs_text&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
   </div>
   <div class="codeComment">
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;i&gt;Best&nbsp;Regards,&lt;/i&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
**&nbsp;&nbsp;gs_text&nbsp;=&nbsp;'&lt;br&gt;&lt;br&gt;'.<br />
**&nbsp;&nbsp;ap.<br />
   </div>
   <div class="code">
ENDFORM.                    "fill_mail_body_Over10000<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SEND<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM send .<br />
&nbsp;&nbsp;DATA:&nbsp;lv_ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;so_text001,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_mess_text&nbsp;TYPE&nbsp;text132,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ex_bcs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cx_bcs.<br />
<br />
&nbsp;&nbsp;TRY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request&nbsp;=&nbsp;cl_bcs=&gt;create_persistent(&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;=&nbsp;text-010.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;strlen(&nbsp;lv_phonenumber&nbsp;)&nbsp;=&nbsp;12.<br />
   </div>
   <div class="codeComment">
*Number&nbsp;is&nbsp;mobile<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;=&nbsp;text-025.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;=&nbsp;cl_document_bcs=&gt;create_document(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_type&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_obj_ty<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_text&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_text<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_subject&nbsp;=&nbsp;subject&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request-&gt;set_document(&nbsp;document&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sender&nbsp;=&nbsp;cl_cam_address_bcs=&gt;create_internet_address(&nbsp;gc_sender&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request-&gt;set_sender(&nbsp;sender&nbsp;).<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_mail&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_mail&nbsp;WHERE&nbsp;email&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recipient&nbsp;=&nbsp;cl_cam_address_bcs=&gt;create_internet_address(&nbsp;gr_mail-&gt;email&nbsp;).<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recipient&nbsp;=&nbsp;cl_cam_address_bcs=&gt;create_internet_address(&nbsp;lv_smtp_addr&nbsp;&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request-&gt;add_recipient(&nbsp;i_recipient&nbsp;=&nbsp;recipient&nbsp;).<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_request-&gt;set_send_immediately(&nbsp;'X'&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_ok&nbsp;=&nbsp;send_request-&gt;send(&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_ok&nbsp;=&nbsp;abap_true.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;rsconn01&nbsp;WITH&nbsp;mode&nbsp;EQ&nbsp;'INT'&nbsp;AND&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_address_bcs&nbsp;cx_send_req_bcs&nbsp;cx_bcs&nbsp;INTO&nbsp;ex_bcs.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'SX_MESSAGE_TEXT_BUILD'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgv1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgv2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgv3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgv4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ex_bcs-&gt;msgv4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_text_output&nbsp;=&nbsp;lv_mess_text.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'SEND:'&nbsp;lv_mess_text<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE&nbsp;lv_mess_text.<br />
<br />
&nbsp;&nbsp;ENDTRY.<br />
ENDFORM.                    " SEND<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVECALLS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM savecalls .<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;If&nbsp;all&nbsp;entries&nbsp;are&nbsp;ok,&nbsp;ALV&nbsp;transferes&nbsp;new&nbsp;values&nbsp;to&nbsp;the&nbsp;output<br />
*&nbsp;table&nbsp;which&nbsp;you&nbsp;then&nbsp;can&nbsp;modify.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;rowid&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;rowid&nbsp;=&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;delete&nbsp;&nbsp;gt_group&nbsp;where&nbsp;makecall&nbsp;eq&nbsp;'X'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;rowid&nbsp;=&nbsp;rowid&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;itab1&nbsp;TYPE&nbsp;zrmca_baddept_head_str.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gt_group[]&nbsp;&lt;&gt;&nbsp;gt_group_old[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group_old&nbsp;INTO&nbsp;itab1&nbsp;INDEX&nbsp;rowid.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gr_group-&gt;makecall&nbsp;NE&nbsp;itab1-makecall.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-makecall&nbsp;=&nbsp;gr_group-&gt;makecall.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gs_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedby&nbsp;=&nbsp;sy-uname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangeddate&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedtime&nbsp;=&nbsp;sy-uzeit.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_debts.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;zrmca_baddept&nbsp;&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'SaveCalls:&nbsp;'&nbsp;'No&nbsp;data&nbsp;changed'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;DATA&nbsp;lv_rowid&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;lv_rowid&nbsp;=&nbsp;rowid.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'SaveCalls:&nbsp;Updates'&nbsp;lv_rowid&nbsp;'items'<br />
&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
<br />
ENDFORM.                    " SAVECALLS<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHANGE_PROCESS_STATUS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM change_process_status USING process_status proccess_type.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gs_debts.<br />
&nbsp;&nbsp;CASE&nbsp;proccess_type.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'SMS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-smsprocess&nbsp;=&nbsp;process_status.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'MAIL'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-emailprocess&nbsp;=&nbsp;process_status.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'LETTER1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-letter1process&nbsp;=&nbsp;process_status.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'LETTER2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-letter2process&nbsp;=&nbsp;process_status.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;gs_debts-lastchangedby&nbsp;=&nbsp;sy-uname.<br />
&nbsp;&nbsp;gs_debts-lastchangeddate&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;gs_debts-lastchangedtime&nbsp;=&nbsp;sy-uzeit.<br />
&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_debts.<br />
   </div>
   <div class="codeComment">
*<br />
*&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;lv_group&nbsp;TO&nbsp;gs_debts.<br />
*&nbsp;&nbsp;gs_debts-smsprocess&nbsp;=&nbsp;process_status.<br />
*&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_debts.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MODIFY&nbsp;&nbsp;zrmca_baddept&nbsp;&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
&nbsp;&nbsp;PERFORM&nbsp;save_email_logs.<br />
<br />
<br />
ENDFORM.                    " CHANGE_PROCESS_STATUS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DATA_RETRIEVAL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM data_retrieval .<br />
<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;zrmca_baddept<br />
&nbsp;&nbsp;&nbsp;&nbsp;UP&nbsp;TO&nbsp;p_max&nbsp;ROWS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE<br />
&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;IN&nbsp;s_gpart<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;vkont&nbsp;IN&nbsp;s_vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;first_unpaid_inv&nbsp;IN&nbsp;p_datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;balance&nbsp;IN&nbsp;p_bal<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;last_producet_inv&nbsp;IN&nbsp;p_duedt<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;phone_number&nbsp;IN&nbsp;p_phnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;adsl_number&nbsp;IN&nbsp;p_adslnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;account_type&nbsp;IN&nbsp;p_acctyp<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;status&nbsp;IN&nbsp;p_status<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;bpkind&nbsp;IN&nbsp;p_bpk<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;bpkind_text&nbsp;IN&nbsp;p_bpktxt<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;mc_name2&nbsp;IN&nbsp;p_name2<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;mc_name1&nbsp;IN&nbsp;p_name1<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;mc_city1&nbsp;IN&nbsp;p_city<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;contact_number&nbsp;IN&nbsp;p_contnr<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;smtp_addr&nbsp;IN&nbsp;p_email<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;makecall&nbsp;IN&nbsp;p_call<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;smsprocess&nbsp;IN&nbsp;p_sms<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;emailprocess&nbsp;IN&nbsp;p_mail<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;letter1process&nbsp;IN&nbsp;p_let1<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;letter2process&nbsp;IN&nbsp;p_let2<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;lastchangedby&nbsp;IN&nbsp;p_last<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;lastchangeddate&nbsp;IN&nbsp;p_ldt<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;lastchangedtime&nbsp;IN&nbsp;p_uzeit.<br />
<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;FROM&nbsp;gt_group.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;zrmca_bd_exc<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_exc.<br />
&nbsp;&nbsp;CHECK&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DELETE&nbsp;gt_group&nbsp;WHERE&nbsp;vkont&nbsp;IN&nbsp;gt_exc.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;gv_address&nbsp;TYPE&nbsp;string.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;laufd&nbsp;&nbsp;&nbsp;EQ&nbsp;p_laufd.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;zrmca_bd_exc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;gt_exc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;vkont&nbsp;EQ&nbsp;gr_group-&gt;vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;gpart&nbsp;EQ&nbsp;gr_group-&gt;gpart<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;phone&nbsp;EQ&nbsp;gr_group-&gt;phone_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;gt_group&nbsp;INDEX&nbsp;sy-tabix."&nbsp;FROM&nbsp;gr_group.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKONT&nbsp;eq&nbsp;GR_GROUP-&gt;VKONT&nbsp;and<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPART&nbsp;eq&nbsp;GR_GROUP-&gt;GPART&nbsp;and<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHONE_NUMBER&nbsp;eq&nbsp;GR_GROUP-&gt;PHONE_NUMBER.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;GT_GROUP&nbsp;where<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VKONT&nbsp;eq&nbsp;GR_GROUP-&gt;VKONT&nbsp;and<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPART&nbsp;eq&nbsp;GR_GROUP-&gt;GPART&nbsp;and<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHONE_NUMBER&nbsp;eq&nbsp;GR_GROUP-&gt;PHONE_NUMBER.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;gr_group-&gt;mc_street<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;str_suppl1<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;str_suppl2<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;str_suppl3<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;location<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;region<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;building<br />
&nbsp;&nbsp;&nbsp;&nbsp;gr_group-&gt;floor<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;gv_address<br />
&nbsp;&nbsp;&nbsp;&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;gv_address&nbsp;=&nbsp;'test&nbsp;addres'.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_group-address&nbsp;=&nbsp;gv_address.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;gt_group&nbsp;FROM&nbsp;gs_group<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRANSPORTING&nbsp;address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;vkont&nbsp;EQ&nbsp;gr_group-&gt;vkont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;gpart&nbsp;EQ&nbsp;gr_group-&gt;gpart<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;first_unpaid_inv&nbsp;EQ&nbsp;gr_group-&gt;first_unpaid_inv<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;last_producet_inv&nbsp;EQ&nbsp;gr_group-&gt;last_producet_inv.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gs_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gv_address.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;SORT&nbsp;gt_group&nbsp;BY&nbsp;balance&nbsp;DESCENDING.<br />
&nbsp;&nbsp;gt_group_old[]&nbsp;=&nbsp;gt_group[].<br />
<br />
ENDFORM.                    " DATA_RETRIEVAL<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVE_AS_PDF<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM save_as_pdf USING pv_counter TYPE i frmname TYPE tdsfname.<br />
&nbsp;&nbsp;DATA:&nbsp;lv_jobname&nbsp;&nbsp;TYPE&nbsp;tbtcjob-jobname,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_jobcount&nbsp;TYPE&nbsp;tbtcjob-jobcount,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_rsparams&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;rsparams,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams&nbsp;TYPE&nbsp;rsparams,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;char1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_counter&nbsp;&nbsp;TYPE&nbsp;char20,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_frmname&nbsp;&nbsp;TYPE&nbsp;tdsfname.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;pv_counter&nbsp;TYPE&nbsp;char2.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;WHILE&nbsp;lv_ok&nbsp;IS&nbsp;INITIAL.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Get&nbsp;number&nbsp;of&nbsp;background&nbsp;active&nbsp;jobs...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;jobname&nbsp;jobcount&nbsp;INTO&nbsp;TABLE&nbsp;gt_tbtco<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;tbtco&nbsp;WHERE&nbsp;status&nbsp;EQ&nbsp;gc_active.<br />
   </div>
   <div class="codeComment">
*&nbsp;Check&nbsp;available&nbsp;background&nbsp;session...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lines(&nbsp;gt_tbtco&nbsp;)&nbsp;LT&nbsp;gv_max_bgd.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_ok&nbsp;=&nbsp;abap_on.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHECK&nbsp;lv_ok&nbsp;EQ&nbsp;abap_on.<br />
   </div>
   <div class="codeComment">
*&nbsp;A&nbsp;background&nbsp;job&nbsp;should&nbsp;be&nbsp;created&nbsp;for&nbsp;certain&nbsp;contract&nbsp;accounts...<br />
*&nbsp;&nbsp;&nbsp;&nbsp;lv_counter&nbsp;=&nbsp;pv_counter.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;pv_counter&nbsp;TO&nbsp;lv_counter.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;lv_counter&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;frmname&nbsp;EQ&nbsp;letter1form.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_frmname&nbsp;=&nbsp;'LETTER1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_frmname&nbsp;=&nbsp;'LETTER2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;sy-cprog&nbsp;lv_frmname&nbsp;'_'&nbsp;lv_counter&nbsp;INTO&nbsp;lv_jobname.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Job&nbsp;open...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'JOB_OPEN'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobname<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobcount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobcount<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cant_create_job&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_job_data&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname_missing&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BP_JOB_DELETE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forcedmode&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobcount&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobcount<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;'save_as_pdf:&nbsp;Job&nbsp;cannot&nbsp;be&nbsp;created...'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i047(&gt;u).<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_SFRMNM'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;frmname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_VKONT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gr_group-&gt;vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_PHNNR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gr_group-&gt;phone_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_UDATE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_dd.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_NTYP'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;nrtype.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_FIRST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gr_group-&gt;first_unpaid_inv.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_LAST'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gr_group-&gt;last_producet_inv.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_GPART'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gr_group-&gt;gpart.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-selname&nbsp;=&nbsp;'P_PROT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-kind&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_rsparams-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;p_prot.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;ls_rsparams&nbsp;TO&nbsp;lt_rsparams.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBMIT&nbsp;zrmca_bad_debts_download_bgd&nbsp;AND&nbsp;RETURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;SELECTION-TABLE&nbsp;lt_rsparams<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER&nbsp;sy-uname&nbsp;VIA&nbsp;JOB&nbsp;lv_jobname&nbsp;NUMBER&nbsp;lv_jobcount.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Job&nbsp;close...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'JOB_CLOSE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobcount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobcount<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_jobname<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strtimmed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abap_on<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cant_start_immediate&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_startdate&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobname_missing&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_close_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_nosteps&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job_notex&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock_failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lgmessage&nbsp;=&nbsp;'save_as_pdf:&nbsp;Error&nbsp;in&nbsp;job&nbsp;step...'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;i050(&gt;u).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDWHILE.<br />
<br />
ENDFORM.                    "save_as_pdf<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_MAX_AVAILABLE_BGD<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM get_max_available_bgd .<br />
&nbsp;&nbsp;DATA&nbsp;gt_wplist&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;wpinfo.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;background&nbsp;session...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'TH_WPINFO'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wplist&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_wplist<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_error&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DELETE&nbsp;gt_wplist&nbsp;WHERE&nbsp;wp_typ&nbsp;NE&nbsp;gc_background.<br />
<br />
&nbsp;&nbsp;gv_max_bgd&nbsp;=&nbsp;lines(&nbsp;gt_wplist&nbsp;).<br />
ENDFORM.                    " GET_MAX_AVAILABLE_BGD<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISPLAY_BILLING<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_GR_GROUP_&gt;VKONT&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISPLAY_BILLING<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM display_billing USING pv_vkont TYPE vkont_kk.<br />
&nbsp;&nbsp;DATA:&nbsp;lt_vkont_ranges&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;fkk_rt_vkont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_vkont_range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;fkkr_vkont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_header_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;fkkinvbill_h_tab,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_header&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;fkkinvbill_h,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_billdocno&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;fkkinv_billdocno_htab.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Link&nbsp;to&nbsp;billing&nbsp;documents...<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ls_vkont_range-sign&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gc_sign_in.<br />
&nbsp;&nbsp;ls_vkont_range-option&nbsp;&nbsp;=&nbsp;gc_opt_eq.<br />
&nbsp;&nbsp;ls_vkont_range-low&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;pv_vkont.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;ls_vkont_range&nbsp;TO&nbsp;lt_vkont_ranges.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_fkkinv_bill_doc=&gt;select<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x_vkont_range_tab&nbsp;=&nbsp;lt_vkont_ranges<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_header_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_header_tab<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;CHECK&nbsp;lt_header_tab[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_header_tab&nbsp;INTO&nbsp;ls_header.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;ls_header-billdocno&nbsp;INTO&nbsp;TABLE&nbsp;lt_billdocno.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'FKK_INV_BILLDOC_DISP'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x_billdocno_tab&nbsp;=&nbsp;lt_billdocno<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;ID&nbsp;sy-msgid&nbsp;TYPE&nbsp;sy-msgty&nbsp;NUMBER&nbsp;sy-msgno<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;sy-msgv1&nbsp;sy-msgv2&nbsp;sy-msgv3&nbsp;sy-msgv4.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.                    " DISPLAY_BILLING<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SENDTOCOURT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM sendtocourt .<br />
<br />
&nbsp;&nbsp;DATA&nbsp;rowid&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;rowid&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;rowid&nbsp;=&nbsp;rowid&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;itab1&nbsp;TYPE&nbsp;zrmca_baddept_head_str.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gt_group[]&nbsp;&lt;&gt;&nbsp;gt_group_old[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group_old&nbsp;INTO&nbsp;itab1&nbsp;INDEX&nbsp;rowid.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gr_group-&gt;courtprocess&nbsp;NE&nbsp;itab1-courtprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-courtprocess&nbsp;=&nbsp;gr_group-&gt;courtprocess.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gs_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedby&nbsp;=&nbsp;sy-uname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangeddate&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedtime&nbsp;=&nbsp;sy-uzeit.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_debts.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;zrmca_baddept&nbsp;&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'SendToCourt:&nbsp;'&nbsp;'No&nbsp;data&nbsp;changed'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;lv_rowid&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;lv_rowid&nbsp;=&nbsp;rowid.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'SendToCourt:&nbsp;Updated'&nbsp;lv_rowid&nbsp;'items'<br />
&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
<br />
ENDFORM.                    " SENDTOCOURT<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVE_NOTE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM save_note .<br />
<br />
&nbsp;&nbsp;DATA&nbsp;rowid&nbsp;TYPE&nbsp;i.<br />
&nbsp;&nbsp;rowid&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;gt_group&nbsp;&nbsp;REFERENCE&nbsp;INTO&nbsp;gr_group.<br />
&nbsp;&nbsp;&nbsp;&nbsp;rowid&nbsp;=&nbsp;rowid&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;itab1&nbsp;TYPE&nbsp;zrmca_baddept_head_str.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gt_group[]&nbsp;&lt;&gt;&nbsp;gt_group_old[].<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;gt_group_old&nbsp;INTO&nbsp;itab1&nbsp;INDEX&nbsp;rowid.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gr_group-&gt;message&nbsp;NE&nbsp;itab1-message.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-message&nbsp;=&nbsp;gr_group-&gt;message.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;gr_group-&gt;*&nbsp;TO&nbsp;gs_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedby&nbsp;=&nbsp;sy-uname.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangeddate&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gs_debts-lastchangedtime&nbsp;=&nbsp;sy-uzeit.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;gs_debts&nbsp;TO&nbsp;gt_debts.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;&nbsp;zrmca_baddept&nbsp;&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;zrmca_baddept_l&nbsp;FROM&nbsp;TABLE&nbsp;gt_debts.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'Save_Note:&nbsp;'&nbsp;'No&nbsp;data&nbsp;changed'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;DATA&nbsp;lv_rowid&nbsp;TYPE&nbsp;string.<br />
&nbsp;&nbsp;lv_rowid&nbsp;=&nbsp;rowid.<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'save_note:&nbsp;Updated'&nbsp;lv_rowid&nbsp;'items'<br />
&nbsp;&nbsp;INTO&nbsp;lgmessage&nbsp;SEPARATED&nbsp;BY&nbsp;space.<br />
&nbsp;&nbsp;PERFORM&nbsp;log_user_activity.<br />
<br />
ENDFORM.                    " SAVE_NOTE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;LOG_USER_ACTIVITY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM log_user_activity .<br />
<br />
&nbsp;&nbsp;username&nbsp;=&nbsp;sy-uname.<br />
&nbsp;&nbsp;createdate&nbsp;=&nbsp;sy-datum.<br />
&nbsp;&nbsp;createtime&nbsp;=&nbsp;sy-uzeit.<br />
&nbsp;&nbsp;DATA&nbsp;terminal&nbsp;LIKE&nbsp;usr41-terminal.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'TERMINAL_ID_GET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;username&nbsp;=&nbsp;sy-uname<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal&nbsp;=&nbsp;terminal.<br />
<br />
&nbsp;&nbsp;lv_zrmca_bduseract-actuser&nbsp;=&nbsp;username.<br />
&nbsp;&nbsp;lv_zrmca_bduseract-createdate&nbsp;=&nbsp;createdate.<br />
&nbsp;&nbsp;lv_zrmca_bduseract-createtime&nbsp;=&nbsp;createtime.<br />
&nbsp;&nbsp;lv_zrmca_bduseract-terminal&nbsp;=&nbsp;terminal.<br />
&nbsp;&nbsp;lv_zrmca_bduseract-message&nbsp;=&nbsp;lgmessage.<br />
&nbsp;&nbsp;lv_zrmca_bduseract-msgty&nbsp;=&nbsp;msgty.<br />
&nbsp;&nbsp;APPEND&nbsp;lv_zrmca_bduseract&nbsp;TO&nbsp;wa_zrmca_bduseract.<br />
&nbsp;&nbsp;MODIFY&nbsp;zrmca_bduseract&nbsp;FROM&nbsp;TABLE&nbsp;wa_zrmca_bduseract.<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
ENDFORM.                    " LOG_USER_ACTIVITY<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;initialize_alv<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM initialize_alv.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;message&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cx_salv_msg.<br />
<br />
&nbsp;&nbsp;TRY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cl_salv_table=&gt;factory(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r_salv_table&nbsp;=&nbsp;alv<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t_table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gt_group&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;enable_layout_settings.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;PERFORM&nbsp;setting_2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;PERFORM&nbsp;setting_3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;PERFORM&nbsp;setting_n.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CATCH&nbsp;cx_salv_msg&nbsp;INTO&nbsp;message.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;error&nbsp;handling<br />
&nbsp;&nbsp;ENDTRY.<br />
ENDFORM.                    " INITIALIZE_ALV<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;enable_layout_settings<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM enable_layout_settings.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;layout_settings&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;cl_salv_layout.<br />
&nbsp;&nbsp;DATA&nbsp;layout_key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;salv_s_layout_key.<br />
<br />
&nbsp;&nbsp;layout_settings&nbsp;=&nbsp;alv-&gt;get_layout(&nbsp;).<br />
<br />
&nbsp;&nbsp;layout_key-report&nbsp;=&nbsp;sy-repid.<br />
&nbsp;&nbsp;layout_settings-&gt;set_key(&nbsp;layout_key&nbsp;).<br />
<br />
&nbsp;&nbsp;layout_settings-&gt;set_save_restriction(&nbsp;if_salv_c_layout=&gt;restrict_none&nbsp;).<br />
ENDFORM.                    "enable_layout_settings<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">* Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2015. Sap Release 731</td>
   </tr>
</table>
</body>
</html>
