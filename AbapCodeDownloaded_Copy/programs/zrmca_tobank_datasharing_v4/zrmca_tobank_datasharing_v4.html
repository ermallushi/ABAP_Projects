<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZRMCA_TOBANK_DATASHARING_V4</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZRMCA_TOBANK_DATASHARING_V4</h2>
<h3> Description: ZRMCA_TOBANK_DATASHARING_V4</h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Report&nbsp;&nbsp;ZRMCA_TOBANK_DATASHARING_V4<br />
*&<br />
*&---------------------------------------------------------------------*<br />
*&<br />
*&<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
REPORT ZRMCA_TOBANK_DATASHARING_V4.<br />
<br />
TABLES: dfkkop.<br />
<br />
TYPES: BEGIN OF ty_file_header,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_line(200),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_file_header,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_file_footer,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;footer_sign(3)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records_count(10)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_file_footer,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_bank_items,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id(7)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phone_number(12)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_name(100)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_number(16)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_number(12)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount&nbsp;TYPE&nbsp;betrw_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inv_date(10)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_bank_items,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_line,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line(1000)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_line,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_dfkkko,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opbel&nbsp;TYPE&nbsp;opbel_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_dfkkko,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_dfkkop,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;opbel&nbsp;TYPE&nbsp;opbel_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;TYPE&nbsp;gpart_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bldat&nbsp;TYPE&nbsp;bldat,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;betrw&nbsp;TYPE&nbsp;betrw_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xblnr&nbsp;TYPE&nbsp;xblnr_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fname&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lname&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_dfkkop,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;OF&nbsp;ty_fkkvkp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;TYPE&nbsp;gpart_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount&nbsp;TYPE&nbsp;betrw_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;ty_fkkvkp.<br />
<br />
DATA: lv_subrc(1) TYPE n,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_filename&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_filetable&nbsp;TYPE&nbsp;filetable,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_filetable&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_filetable,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_line&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_line&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_line&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_line,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_header&nbsp;TYPE&nbsp;ty_file_header,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_footer&nbsp;TYPE&nbsp;ty_file_footer,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_items&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_bank_items,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_items,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_lines&nbsp;TYPE&nbsp;sytfill,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_vkont&nbsp;TYPE&nbsp;vkont_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_duedate&nbsp;TYPE&nbsp;timestamp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_timestamp(20)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_dfkkop&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_dfkkop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;NON-UNIQUE&nbsp;KEY&nbsp;vkont&nbsp;gpart,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_dfkkop2&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_dfkkop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;NON-UNIQUE&nbsp;KEY&nbsp;vkont&nbsp;gpart,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_dfkkop&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_dfkkop,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_dfkkop_inner&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_dfkkop,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_dfkkko&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_dfkkko,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_dfkkko&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_dfkkko,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_fkkvkp&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_fkkvkp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_fkkvkp2&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ty_fkkvkp,<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_fkkvkp&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;lt_fkkvkp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_partner1&nbsp;TYPE&nbsp;gpart_kk.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;gv_lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;i.<br />
<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-001.<br />
<br />
PARAMETERS: p_datum LIKE dfkkko-budat.<br />
<br />
SELECT-OPTIONS: so_vkont FOR dfkkop-vkont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so_gpart&nbsp;FOR&nbsp;dfkkop-gpart.<br />
<br />
SELECTION-SCREEN SKIP 1.<br />
<br />
PARAMETERS: p_filed TYPE localfile<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT&nbsp;'/albtelecom/rmca/outbound/datasharing/'.<br />
<br />
SELECTION-SCREEN END OF BLOCK b1.<br />
<br />
SELECTION-SCREEN BEGIN OF BLOCK b2 WITH FRAME TITLE text-002.<br />
<br />
PARAMETERS: p_wsd AS CHECKBOX USER-COMMAND flag DEFAULT ' '.<br />
<br />
SELECTION-SCREEN END OF BLOCK b2.<br />
<br />
INITIALIZATION.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;initialization.<br />
<br />
START-OF-SELECTION.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_subrc,&nbsp;lv_filename.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;get_items.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;download_file.<br />
<br />
   </div>
   <div class="codeComment">
*in&nbsp;case&nbsp;of&nbsp;error&nbsp;leave&nbsp;the&nbsp;program<br />
   </div>
   <div class="code">
&nbsp;&nbsp;IF&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_ITEMS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM get_items .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_date&nbsp;TYPE&nbsp;sydatum,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_sum&nbsp;TYPE&nbsp;betrw_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_partnertext&nbsp;TYPE&nbsp;text1gp_kk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_custcode&nbsp;TYPE&nbsp;bu_id_number,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_tdata&nbsp;TYPE&nbsp;ist_tdata,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_tdata&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ist_tdata&nbsp;WITH&nbsp;HEADER&nbsp;LINE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_off&nbsp;TYPE&nbsp;i.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;lv_date,&nbsp;lt_dfkkop[],&nbsp;lt_dfkkko[].<br />
<br />
&nbsp;&nbsp;MOVE&nbsp;p_datum&nbsp;TO&nbsp;lv_date.<br />
<br />
   </div>
   <div class="codeComment">
*invoices&nbsp;are&nbsp;always&nbsp;posted&nbsp;at&nbsp;the&nbsp;first&nbsp;of&nbsp;the&nbsp;month<br />
<br />
<br />
*&nbsp;&lt;IHOSKO&gt;<br />
*<br />
*&nbsp;before:<br />
*-----------------------<br />
*&nbsp;SELECT&nbsp;....<br />
*&nbsp;SORT&nbsp;...<br />
*&nbsp;DELETE&nbsp;ADJACENT&nbsp;DUPLICATES&nbsp;...<br />
*<br />
*&nbsp;after:<br />
*-----------------------<br />
*&nbsp;SELECT&nbsp;DISTINCT&nbsp;...<br />
*<br />
<br />
<br />
<br />
*&nbsp;&nbsp;SELECT&nbsp;opbel&nbsp;gpart&nbsp;vkont&nbsp;bldat&nbsp;betrw&nbsp;xblnr<br />
*&nbsp;&nbsp;SELECT&nbsp;DISTINCT&nbsp;opbel&nbsp;gpart&nbsp;vkont&nbsp;bldat&nbsp;betrw&nbsp;xblnr<br />
*&nbsp;&lt;/IHOSKO&gt;<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;lt_dfkkop<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dfkkop<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;augst&nbsp;EQ&nbsp;'&nbsp;'&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;IN&nbsp;so_gpart&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;IN&nbsp;so_vkont&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;budat&nbsp;EQ&nbsp;lv_date&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blart&nbsp;EQ&nbsp;'YA'.<br />
<br />
<br />
<br />
<br />
*&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;BUT000<br />
*BUT000~NAME_FIRST&nbsp;as&nbsp;fname&nbsp;BUT000~NAME_LAST&nbsp;as&nbsp;lname<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;DISTINCT&nbsp;gpart&nbsp;vkont&nbsp;SUM(&nbsp;betrw&nbsp;)&nbsp;as&nbsp;Amount<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;lt_fkkvkp<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dfkkop<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;augst&nbsp;EQ&nbsp;'&nbsp;'&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;IN&nbsp;so_gpart&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;IN&nbsp;so_vkont&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;budat&nbsp;EQ&nbsp;lv_date&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;blart&nbsp;EQ&nbsp;'YA'&nbsp;OR&nbsp;blart&nbsp;EQ&nbsp;'YO'&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;GROUP&nbsp;BY&nbsp;gpart&nbsp;vkont.<br />
<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0&nbsp;OR&nbsp;lt_fkkvkp[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'No&nbsp;documents&nbsp;found&nbsp;for&nbsp;date:&nbsp;',&nbsp;lv_date.<br />
&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_fkkvkp&nbsp;LINES&nbsp;gv_lines.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Found:&nbsp;',&nbsp;gv_lines.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_fkkvkp&nbsp;INTO&nbsp;wa_fkkvkp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;wa_fkkvkp-gpart,&nbsp;wa_fkkvkp-vkont,&nbsp;wa_fkkvkp-Amount.<br />
   </div>
   <div class="codeComment">
*&nbsp;WRITE:&nbsp;wa_dfkkop-fname.<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_fkkvkp&nbsp;INTO&nbsp;wa_fkkvkp.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_partnertext,&nbsp;lt_tdata[],&nbsp;lv_off.<br />
<br />
<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;wa_dfkkop-fname&nbsp;wa_dfkkop-lname&nbsp;INTO&nbsp;lv_partnertext&nbsp;SEPARATED&nbsp;BY&nbsp;SPACE.<br />
<br />
<br />
*&nbsp;IH&nbsp;ovaj&nbsp;FM&nbsp;prekucat&nbsp;u&nbsp;obi#an&nbsp;select&nbsp;partnera<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'FKK_PARTNER_HEADER_DISPLAY'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x_partner&nbsp;=&nbsp;wa_fkkvkp-gpart<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_text1&nbsp;&nbsp;&nbsp;=&nbsp;lv_partnertext.<br />
<br />
&nbsp;&nbsp;&nbsp;FIND&nbsp;FIRST&nbsp;OCCURRENCE&nbsp;OF&nbsp;'/'&nbsp;IN&nbsp;lv_partnertext&nbsp;MATCH&nbsp;OFFSET&nbsp;lv_off.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_off&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_off&nbsp;=&nbsp;lv_off&nbsp;-&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;lv_partnertext.<br />
<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;ls_tdata,&nbsp;lv_duedate,&nbsp;lv_timestamp.<br />
<br />
   </div>
   <div class="codeComment">
*fill&nbsp;selection&nbsp;structure<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_fkkvkp-vkont&nbsp;TO&nbsp;ls_tdata-vkont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;'TEL'&nbsp;TO&nbsp;ls_tdata-service.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;sy-datum&nbsp;sy-uzeit&nbsp;INTO&nbsp;lv_timestamp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_timestamp&nbsp;TO&nbsp;lv_duedate.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'IST_TDATA_SEARCH'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_ist_tdata&nbsp;&nbsp;&nbsp;=&nbsp;ls_tdata<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iv_groupsearch&nbsp;=&nbsp;'&nbsp;'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iv_duedate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_duedate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nmax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'3000'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;et_ist_tdata&nbsp;&nbsp;&nbsp;=&nbsp;lt_tdata.<br />
<br />
<br />
&nbsp;&nbsp;DATA&nbsp;wa&nbsp;TYPE&nbsp;ty_dfkkop.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;opbel&nbsp;gpart&nbsp;vkont&nbsp;bldat&nbsp;betrw&nbsp;xblnr<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;lt_dfkkop<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dfkkop<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;(wa-opbel,&nbsp;wa-gpart,&nbsp;wa-vkont,&nbsp;wa-bldat,&nbsp;wa-betrw,&nbsp;wa-xblnr)<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;augst&nbsp;EQ&nbsp;'&nbsp;'&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;EQ&nbsp;wa_fkkvkp-gpart&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;EQ&nbsp;wa_fkkvkp-vkont&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;budat&nbsp;EQ&nbsp;lv_date&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;blart&nbsp;EQ&nbsp;'YA'&nbsp;OR&nbsp;blart&nbsp;EQ&nbsp;'YO'&nbsp;).<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA:&nbsp;s&nbsp;TYPE&nbsp;I.<br />
*&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;betrw&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;s<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dfkkop<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;augst&nbsp;EQ&nbsp;'&nbsp;'&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;EQ&nbsp;wa_dfkkop-gpart&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vkont&nbsp;EQ&nbsp;wa_dfkkop-vkont&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;budat&nbsp;EQ&nbsp;lv_date&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;blart&nbsp;EQ&nbsp;'YA'&nbsp;OR&nbsp;blart&nbsp;EQ&nbsp;'YO'&nbsp;).<br />
<br />
<br />
<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_dfkkop&nbsp;INTO&nbsp;wa_dfkkop_inner<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;vkont&nbsp;EQ&nbsp;wa_dfkkop-vkont&nbsp;AND<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gpart&nbsp;EQ&nbsp;wa_dfkkop-gpart.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;wa_items.<br />
<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa-xblnr&nbsp;TO&nbsp;wa_items-invoice_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHIFT&nbsp;wa_items-invoice_number&nbsp;LEFT&nbsp;DELETING&nbsp;LEADING&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa-vkont&nbsp;TO&nbsp;wa_items-customer_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHIFT&nbsp;wa_items-invoice_number&nbsp;LEFT&nbsp;DELETING&nbsp;LEADING&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_fkkvkp-amount&nbsp;TO&nbsp;wa_items-amount.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_dfkkop_inner-betrw&nbsp;TO&nbsp;wa_items-amount.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;wa-bldat+6(2)&nbsp;'/'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa-bldat+4(2)&nbsp;'/'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa-bldat+0(4)&nbsp;INTO&nbsp;wa_items-inv_date.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDSELECT.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_partnertext&nbsp;TO&nbsp;wa_items-customer_name.<br />
<br />
*Consider&nbsp;only&nbsp;name&nbsp;and&nbsp;not&nbsp;address<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lv_off&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_partnertext&nbsp;TO&nbsp;wa_items-customer_name.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lv_partnertext+0(lv_off)&nbsp;&nbsp;TO&nbsp;wa_items-customer_name.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;wa_items-customer_name.<br />
<br />
<br />
*If&nbsp;more&nbsp;telephone&nbsp;numbers&nbsp;are&nbsp;active,&nbsp;nothing&nbsp;should&nbsp;be&nbsp;selected<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;lines(&nbsp;lt_tdata&nbsp;)&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;lt_tdata&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;lt_tdata-object_id&nbsp;NO-GAPS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;lt_tdata-object_id&nbsp;TO&nbsp;wa_items-phone_number.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;wa_items&nbsp;INTO&nbsp;lt_items.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*No&nbsp;negative&nbsp;amounts&nbsp;should&nbsp;be&nbsp;in&nbsp;the&nbsp;datasharing&nbsp;file<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_items&nbsp;INTO&nbsp;wa_items.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;wa_items-amount&nbsp;&lt;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;lt_items&nbsp;INDEX&nbsp;sy-tabix.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.                    " GET_ITEMS<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DOWNLOAD_FILE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM download_file .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;lv_rec_count&nbsp;TYPE&nbsp;sytfill,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_line&nbsp;TYPE&nbsp;string,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_betrw(18)&nbsp;TYPE&nbsp;c,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_filename_cl&nbsp;TYPE&nbsp;string.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;ls_footer,&nbsp;lv_rec_count,&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;p_filed&nbsp;'BANK_DATASHARING_V3'&nbsp;sy-datum&nbsp;'_'&nbsp;sy-uzeit&nbsp;'.csv'&nbsp;INTO&nbsp;p_filed.<br />
<br />
   </div>
   <div class="codeComment">
*define&nbsp;file&nbsp;header<br />
   </div>
   <div class="code">
&nbsp;&nbsp;ls_header-header_line&nbsp;=<br />
&nbsp;&nbsp;&nbsp;&nbsp;'ID|PHONE_NUMBER|CUSTOMER_NAME|INVOICE_NUMBER|'&nbsp;&<br />
&nbsp;&nbsp;&nbsp;&nbsp;'CUSTOMER_NUMBER|AMOUNT|INV_DATE'.<br />
<br />
   </div>
   <div class="codeComment">
*define&nbsp;file&nbsp;footer<br />
   </div>
   <div class="code">
&nbsp;&nbsp;MOVE&nbsp;'EOF'&nbsp;TO&nbsp;ls_footer-footer_sign.<br />
<br />
&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;lt_items&nbsp;LINES&nbsp;lv_rec_count.<br />
<br />
&nbsp;&nbsp;MOVE&nbsp;lv_rec_count&nbsp;TO&nbsp;ls_footer-records_count.<br />
&nbsp;&nbsp;CONDENSE&nbsp;ls_footer-records_count&nbsp;NO-GAPS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;p_wsd&nbsp;IS&nbsp;NOT&nbsp;INITIAL.&nbsp;"local&nbsp;file&nbsp;download<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;ls_header-header_line&nbsp;TO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_line&nbsp;TO&nbsp;lt_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_items&nbsp;INTO&nbsp;wa_items.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_line,&nbsp;lv_betrw.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;sy-tabix&nbsp;TO&nbsp;wa_items-id.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;wa_items-id&nbsp;NO-GAPS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_items-amount&nbsp;TO&nbsp;lv_betrw.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;lv_betrw&nbsp;NO-GAPS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;wa_items-id&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-phone_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-customer_name&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-invoice_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-customer_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_betrw&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-inv_date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_line&nbsp;TO&nbsp;lt_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;ls_footer-footer_sign&nbsp;';'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_footer-records_count<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;lv_line&nbsp;TO&nbsp;lt_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;p_filed&nbsp;TO&nbsp;lv_filename_cl.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;cl_gui_frontend_services=&gt;gui_download<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lv_filename_cl<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filetype&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'DAT'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;show_transfer_status&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_tab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lt_line[]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_write_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_batch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gui_refuse_filetransfer&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_authority&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_not_allowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator_not_allowed&nbsp;&nbsp;&nbsp;=&nbsp;8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filesize_not_allowed&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_too_long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_error_create&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_error_send&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_error_write&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;13<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unknown_dp_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;14<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;access_denied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_out_of_memory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;16<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disk_full&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;17<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_timeout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;18<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;19<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataprovider_exception&nbsp;&nbsp;=&nbsp;20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;control_flush_error&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;21<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_supported_by_gui&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;22<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_no_gui&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;23<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;24.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;while&nbsp;creating&nbsp;the&nbsp;file:&nbsp;',&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;p_filed,&nbsp;'created!'.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;OPEN&nbsp;DATASET&nbsp;p_filed&nbsp;FOR&nbsp;OUTPUT&nbsp;IN&nbsp;TEXT&nbsp;MODE&nbsp;ENCODING&nbsp;DEFAULT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;while&nbsp;creating&nbsp;the&nbsp;file:&nbsp;',&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*transfer&nbsp;file&nbsp;header<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;ls_header-header_line&nbsp;TO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;TRANSFER&nbsp;lv_line&nbsp;TO&nbsp;p_filed.<br />
<br />
   </div>
   <div class="codeComment">
*transfer&nbsp;file&nbsp;items<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;lt_items&nbsp;INTO&nbsp;wa_items.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_line,&nbsp;lv_betrw.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;sy-tabix&nbsp;TO&nbsp;wa_items-id.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE&nbsp;wa_items-amount&nbsp;TO&nbsp;lv_betrw.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;lv_betrw&nbsp;NO-GAPS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;wa_items-id&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-phone_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-customer_name&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-invoice_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-customer_number&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_betrw&nbsp;'|'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wa_items-inv_date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRANSFER&nbsp;lv_line&nbsp;TO&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;lv_line.<br />
<br />
   </div>
   <div class="codeComment">
*transfer&nbsp;file&nbsp;footer<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;ls_footer-footer_sign&nbsp;';'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ls_footer-records_count<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;lv_line.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;TRANSFER&nbsp;lv_line&nbsp;TO&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLOSE&nbsp;DATASET&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;NE&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Error&nbsp;while&nbsp;creating&nbsp;the&nbsp;file:&nbsp;',&nbsp;p_filed.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_subrc&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'Successfully&nbsp;created&nbsp;file:&nbsp;',&nbsp;&nbsp;p_filed.<br />
<br />
ENDFORM.                    " DOWNLOAD_FILE<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;INITIALIZATION<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM initialization .<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'FKK_LAST_DAY_OF_MONTH'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day_in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_day_of_month&nbsp;=&nbsp;p_datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day_in_no_date&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
<br />
ENDFORM.                    " INITIALIZATION<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">* Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2015. Sap Release 731</td>
   </tr>
</table>
</body>
</html>
